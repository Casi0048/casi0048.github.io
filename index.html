<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Verifica â€” Ricerca | Echi di Sofia</title>
  <meta name="description" content="Pagina di verifica con ricerca interna per Echi di Sofia">
  <link rel="icon" type="image/png" href="favicon_io/favicon-32x32.png">

  <!-- Stili base (look & feel Echi di Sofia) -->
  <style>
    :root{
      --bg:#0a0a1a; --text:#e9eef5; --gold:#ffd86a; --cyan:#9ad0ff;
      --panel:rgba(10,10,30,.94); --border:rgba(255,215,0,.22);
    }
    *{ box-sizing:border-box; }
    html{ scroll-behavior:smooth; }
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      min-height:100dvh; display:flex; flex-direction:column;
    }
    a{ color:var(--cyan); text-decoration:none; }
    a:hover{ color:#fff; text-decoration:underline; }

    /* Topbar */
    header.topbar{
      position:sticky; top:0; z-index:50;
      background:rgba(10,10,30,.96);
      border-bottom:1px solid var(--border);
      backdrop-filter: blur(8px);
    }
    .wrap{ width:min(1100px, 94vw); margin:0 auto; }
    .row{ display:flex; align-items:center; gap:.75rem; padding:.8rem 1rem; }
    .brand{ display:flex; align-items:center; gap:.5rem; color:var(--gold); font-weight:800; }
    .brand img{ width:32px; height:32px; filter:drop-shadow(0 0 .5rem rgba(255,215,0,.35)); }
    .brand span{
      background:linear-gradient(90deg,#ffd700,#fff7b0,#ffd700);
      -webkit-background-clip:text; background-clip:text; color:transparent; letter-spacing:.04em;
    }
    .spacer{ flex:1; }
    .nav a{ font-weight:700; color:var(--cyan); }
    .nav a:hover{ color:#fff; }

    /* Search area */
    .search-area{ padding:1rem 1rem .2rem; }
    .searchbar{
      position:relative; display:flex; align-items:center; gap:.5rem;
      background:var(--panel); border:1px solid rgba(255,255,255,.12);
      border-radius:14px; padding:.6rem .75rem;
      box-shadow: 0 .8rem 1.6rem rgba(0,0,0,.35) inset;
    }
    .searchbar input{
      flex:1; background:transparent; border:0; outline:0; color:var(--text); font-size:1rem;
      padding:.35rem .5rem;
    }
    .searchbar .icon{ opacity:.7; }

    .hint{ opacity:.8; font-size:.92rem; padding:.5rem .2rem 0; }

    main{ flex:1; }
    .results{ display:grid; gap:.9rem; padding:1rem; }
    .card{
      background:var(--panel); border:1px solid var(--border); border-radius:14px;
      padding:1rem; box-shadow: 0 .8rem 2rem rgba(0,0,0,.35);
    }
    .card a.title{ color:var(--gold); font-weight:800; text-decoration:none; font-size:1.08rem; }
    .card a.title:hover{ color:#fff; text-decoration:underline; }
    .url{ font-size:.85rem; color:#9bb7ff; opacity:.9; margin:.2rem 0 .4rem; word-break:break-all; }
    .desc{ color:#cfe2ff; opacity:.95; line-height:1.35; }

    /* CTA */
    .cta{ display:flex; gap:.6rem; flex-wrap:wrap; justify-content:center; padding:0 1rem 1rem; }
    .btn{ display:inline-flex; align-items:center; gap:.4rem; padding:.55rem .85rem; border-radius:.6rem;
      border:1px solid var(--border); background:rgba(20,20,40,.78); font-weight:700; color:#ffdf8a; }
    .btn.secondary{ color:#9ad0ff; border-color: rgba(0,204,255,.35); }

    mark{
      background:linear-gradient(90deg, rgba(255,216,106,.35), rgba(154,208,255,.35));
      border-radius:.25rem; padding:.05rem .15rem;
    }
    footer{ margin-top:auto; padding:1rem; text-align:center; color:#9ec3ff;
      border-top:1px solid rgba(255,255,255,.06); }
  </style>
</head>
<body>

  <header class="topbar">
    <div class="wrap row">
      <a class="brand" href="index.html">
        <img src="logo-filosofia.svg" alt="Echi di Sofia">
        <span>Echi di Sofia</span>
      </a>
      <div class="spacer"></div>
      <nav class="nav">
        <a href="index.html">Incipit</a>
      </nav>
    </div>
    <div class="wrap search-area">
      <div class="searchbar">
        <svg class="icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <input id="site-search" type="search" placeholder="Cerca nel sitoâ€¦ (es. Platone, Ipazia, Talete)"
               autocomplete="off" spellcheck="false" aria-label="Cerca nel sito">
      </div>
      <div class="hint">Suggerimento: puoi cercare per <em>titolo</em> o parole nella <em>descrizione</em>.</div>
    </div>
  </header>

  <main class="wrap">
    <div class="cta">
      <a class="btn" href="/articoli/#lista-articoli">ðŸ“– Vai alla griglia</a>
      <a class="btn secondary" href="articoli/">Apri sezione Articoli</a>
    </div>
    <section id="results" class="results" role="list" aria-live="polite"></section>
  </main>

  <footer>Â© 2025 Echi di Sofia</footer>

  <!-- Config: indice ricerche (root) -->
  <script id="search-config">
    window.SEARCH_INDEX_URLS = [
      '/search-index.json',
      'search-index.json',
      '/assets/search-index.json'
    ];
  </script>

  <!-- Ricerca semplice su JSON [{title,url,desc}] -->
  <script>
  (function(){
    const RESULTS_LIMIT = 60;
    const $q = document.getElementById('site-search');
    const $res = document.getElementById('results');

    const SOURCES = (window.SEARCH_INDEX_URLS && window.SEARCH_INDEX_URLS.length)
      ? window.SEARCH_INDEX_URLS
      : ['search-index.json','/search-index.json','/assets/search-index.json'];

    function norm(s){
      return (s || '')
        .toString()
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g,'')  // rimuove i diacritici (compatibile)
        .toLowerCase();
    }

    function highlight(text, query){
      if(!text) return '';
      try{
        const tokens = norm(query).split(/\s+/).filter(Boolean);
        if(!tokens.length) return text;
        let out = text;
        for(const t of tokens){
          if(t.length < 2) continue;
          const re = new RegExp('(' + t.replace(/[.*+?^${}()|[\]\\]/g,'\\$&') + ')','gi');
          out = out.replace(re, '<mark>$1</mark>');
        }
        return out;
      }catch(_){ return text; }
    }

    function normalize(item){
      const title = item.title || item.name || item.slug || 'Senza titolo';
      const url   = (item.url || item.link || '').toString();
      const desc  = item.desc || item.description || item.excerpt || item.summary || '';
      return { title, url, desc };
    }

    function card(it, query){
      const href = it.url.startsWith('http')
        ? it.url
        : (it.url.startsWith('/') ? it.url : './' + it.url.replace(/^\.\//,''));
      const desc = it.desc && it.desc.trim() ? it.desc : '';
      return \`<article class="card" role="listitem">
        <a class="title" href="\${href}">\${highlight(it.title, query)}</a>
        <div class="url">\${href}</div>
        \${desc ? \`<div class="desc">\${highlight(desc, query)}</div>\` : ''}
      </article>\`;
    }

    function search(items, query){
      const q = norm(query);
      if(!q) return [];
      return items.filter(it => {
        const t = norm(it.title);
        const d = norm(it.desc);
        const u = norm(it.url);
        return t.includes(q) || d.includes(q) || u.includes(q);
      }).slice(0, RESULTS_LIMIT);
    }

    function render(list, query){
      if(!list.length){
        $res.innerHTML = \`<p style="opacity:.8;padding:0 1rem">Nessun risultato per <strong>\${query}</strong>.</p>\`;
        return;
      }
      $res.innerHTML = list.map(it => card(it, query)).join('');
    }

    function debounce(fn, ms){
      let t; return (...args) => { clearTimeout(t); t = setTimeout(() => fn(...args), ms); };
    }

    const onInput = debounce(() => {
      const q = $q.value.trim();
      if(q.length === 0){ $res.innerHTML = ''; return; }
      const list = search(INDEX, q);
      render(list, q);
    }, 120);

    let INDEX = [];
    async function loadIndex(){
      for(const u of SOURCES){
        try{
          const r = await fetch(u, { cache: 'no-store' });
          if(!r.ok) continue;
          const data = await r.json();
          return Array.isArray(data) ? data : (data.items || data.entries || []);
        }catch(_){ /* try next */ }
      }
      return [];
    }

    // Init
    $q.addEventListener('input', onInput);
    $q.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ onInput(); } });
    loadIndex().then(arr => { INDEX = arr.map(normalize); $q.focus(); });
  })();
  </script>
</body>
</html>
