<script>
    (function(){
        // Single loader (re-add ours)
        var s = document.createElement('script');
        s.async = true; s.src = "https://cse.google.com/cse.js?cx=87b07564ab3cb462a";
        document.documentElement.appendChild(s);
      
        var panel = document.getElementById('cseCL-panel');
        var backdrop = document.getElementById('cseCL-backdrop');
        var closeBt = document.getElementById('cseCL-close');
        var resultsDiv = document.getElementById('cseCL-results');
        var RENDERED_FLAG = '__cseCL_rendered__';
      
        function openPanel(){ panel.setAttribute('aria-hidden','false'); document.documentElement.style.overflow='hidden'; }
        function closePanel(){ panel.setAttribute('aria-hidden','true'); document.documentElement.style.overflow=''; }
        closeBt.addEventListener('click', closePanel);
        backdrop.addEventListener('click', closePanel);
        document.addEventListener('keydown', function(e){ if(e.key==='Escape') closePanel(); }, true);
      
        function currentQuery(){
          var i = document.getElementById('site-search') ||
                  document.querySelector(');
          // also clear the container
          resultsDiv.innerHTML = '<div id="cseCL-root"></div>';
        }
      
        function ensureRendered(){
          if (window[RENDERED_FLAG]) return true;
          try{
            if (!(window.google && google.search && google.search.cse && google.search.cse.element)) return false;
            clearDuplicateGcseInsidePanel();
            google.search.cse.element.render({
              div: 'cseCL-root',
              tag: 'searchresults-only',
              gname: 'results' // use a fixed gname
            });
            window[RENDERED_FLAG] = true;
            return true;
          }catch(e){ console.error(e); return false; }
        }
      
        function execInternal(q){
          q = (q||'').trim(); if(!q) return;
          openPanel();
          var start = Date.now();
          (function tick(){
            try{
              if (ensureRendered()){
                var api = google.search.cse.element;
                var el = api.getElement('results');
                if (el && typeof el.execute === 'function'){ el.execute(q); return; }
              }
            }catch(e){ console.error(e); }
            if (Date.now()-start < 8000){ return setTimeout(tick, 60); }
          })();
        }
      
        // Hard-neutralize external openers
        window.googleUrl = function(){ return '#'; };
        window.openGoogleFromInput = function(){ execInternal(currentQuery()); };
        window.submitFromInput = function(){ execInternal(currentQuery()); };
        window.executeQuery = function(q){ execInternal(q); };
      
        // Capture handlers to block external navigation and duplicates
        function isLens(el){
          if (!el) return false;
          if (el.matches && el.matches('.search-icon, .fa-magnifying-glass, [data-cse-search-btn], #cse-search-btn, .cse-search-btn, button[type=submit]')) return true;
          return !!(el.closest && el.closest('.search-icon, .fa-magnifying-glass, [data-cse-search-btn], #cse-search-btn, .cse-search-btn, .search button, button[type=submit]'));
        }
        function isSearchInput(el){ return el && el.tagName==='INPUT' && (el.type==='search' || el.type==='text'); }
      
        document.addEventListener('keydown', function(e){
          if (e.key!=='Enter') return;
          if (isSearchInput(e.target)){
            e.preventDefault(); e.stopPropagation(); if (e.stopImmediatePropagation) e.stopImmediatePropagation();
            execInternal(currentQuery());
          }
        }, true);
      
        document.addEventListener('click', function(e){
          if (isLens(e.target)){
            e.preventDefault(); e.stopPropagation(); if (e.stopImmediatePropagation) e.stopImmediatePropagation();
            execInternal(currentQuery());
          }
        }, true);
      
        document.addEventListener('submit', function(e){
          if (e && e.target && e.target.querySelector && e.target.querySelector('input[type="search"], input[type="text"]')){
            e.preventDefault(); e.stopPropagation(); if (e.stopImmediatePropagation) e.stopImmediatePropagation();
            execInternal(currentQuery());
          }
        }, true);
      })();
  </script>
