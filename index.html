<!-- === CONSERVATIVE: Floater Tuono in alto a destra, etichetta fissa === -->
<script>
(function(){
  if (window.__tuonoFloater) return; window.__tuonoFloater = true;

  // CSS forte e unico
  const css = `
    :root{ --tuono-x:16px; --tuono-y:16px; }
    #btn-tuono{
      position: fixed !important;
      right: var(--tuono-x) !important;
      top: var(--tuono-y) !important;
      left: auto !important;
      bottom: auto !important;
      z-index: 9999 !important;
      pointer-events: auto !important;
    }
    @media (max-width:480px){
      :root{ --tuono-y:24px; }
    }
  `;
  let st = document.getElementById('floater-tuono-style');
  if (!st){
    st = document.createElement('style');
    st.id = 'floater-tuono-style';
    st.textContent = css;
    document.head.appendChild(st);
  }

  // Assicura la presenza del bottone
  let btn = document.getElementById('btn-tuono');
  if (!btn){
    btn = document.createElement('button');
    btn.id = 'btn-tuono';
    btn.type = 'button';
    btn.setAttribute('aria-label','Tuono');
    btn.textContent = '⚡ Tuono';
    document.body.appendChild(btn);
  }

  // Etichetta sempre “⚡ Tuono” (non far comparire “ON/OFF”)
  const label = '⚡ Tuono';
  btn.textContent = label;
  const obs = new MutationObserver(() => {
    if (btn.textContent !== label) btn.textContent = label;
  });
  obs.observe(btn, {characterData:true, childList:true, subtree:true});

  // Click → usa toggleThunder se esiste, altrimenti fallback audio locale
  if (!btn._wired){
    btn.addEventListener('click', function(e){
      e.preventDefault();
      if (typeof window.toggleThunder === 'function'){
        window.toggleThunder();
        return;
      }
      // fallback conservativo
      let audio = document.getElementById('thunder-sound');
      if (!audio){
        audio = document.createElement('audio');
        audio.id = 'thunder-sound';
        audio.preload = 'auto';
        const src = document.createElement('source');
        src.src = 'suoni/thunder-sound.mp3'; // <-- metti qui il tuo percorso reale
        src.type = 'audio/mpeg';
        audio.appendChild(src);
        audio.style.display = 'none';
        document.body.appendChild(audio);
      }
      try{ audio.currentTime = 0; audio.play(); }catch(_){}
    });
    btn._wired = true;
  }
})();
</script>
