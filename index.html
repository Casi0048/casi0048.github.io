<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Test Safari ‚Äì Slider verticale + Tuono</title>
  <!-- Performance hint per immagini su GitHub -->
  <link rel="preconnect" href="https://raw.githubusercontent.com" crossorigin>
  <style>
    :root{
      --bg:#070812;
      --gold:#ffd86a;
      --panel:rgba(10,10,30,.85);
      --cyan:#3cf;
    }
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(1200px 600px at 20% -20%, rgba(0,60,120,.25), transparent),
                  radial-gradient(1000px 400px at 110% -10%, rgba(255,200,0,.08), transparent),
                  var(--bg);
      color:#e8f2ff; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }
    a.skip-link{
      position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden;
    }
    a.skip-link:focus{left:10px; top:10px; width:auto; height:auto; padding:6px 10px; background:#000; color:#fff; border-radius:6px}

    main{max-width:1100px; margin:24px auto; padding:0 16px}
    h1{font-weight:700; letter-spacing:.3px; font-size:clamp(22px,2.6vw,30px); margin:0 0 12px}
    p.lead{opacity:.9; margin:0 0 20px}

    /* ===== Slider verticale (demo indipendente) ===== */
    .slider-wrap{
      display:grid; grid-template-columns: 260px 1fr; gap:20px; align-items:start;
    }
    .slider-vertical{
      width:260px; height:360px; overflow:hidden; border-radius:12px;
      border:1px solid rgba(255,215,0,.18);
      background: rgba(0,0,0,.25);
      box-shadow: 0 6px 18px rgba(0,0,0,.35) inset;
    }
    .slider-inner{ will-change: transform; }
    .slide-vertical{ display:grid; place-items:center; padding:6px 0; }
    .slide-vertical img{
      width:260px; height:340px; object-fit:contain;
      background: rgba(0,0,0,.35);
      border-radius:8px;
    }
    .slide-vertical p{
      margin:6px 0 0; font-size:14px;
      background: linear-gradient(to bottom, rgba(0,0,0,.35), rgba(0,0,0,.35));
      padding: 3px 6px; border-radius:6px;
    }

    /* ===== Controlli (slider + tuono) ===== */
    #thunder-controls{
      position: fixed; left: 52px; top: 420px;
      z-index: 9999;
      display: flex; flex-direction: column; gap: 10px;
      background: var(--panel);
      color: #aef;
      border: 1px solid var(--cyan);
      border-radius: 12px;
      padding: 10px 12px;
      box-shadow: 0 0 12px var(--cyan);
    }
    #thunder-controls .ctrl-btn{
      display:inline-flex; align-items:center; justify-content:center;
      min-width: 44px;
      padding: 6px 10px;
      border-radius:8px;
      border:1px solid rgba(255,215,0,.25);
      background: rgba(20,20,40,.7);
      color: var(--gold);
      font-weight:600; cursor:pointer;
      transition: transform .2s ease;
    }
    #thunder-controls .ctrl-btn:hover{ transform:scale(1.06) }
    #thunder-controls .ctrl-btn.active{ box-shadow:0 0 10px rgba(255,215,0,.5) inset }
    .speed-label{ font-size:.85rem; color:#cfe8ff; display:flex; flex-direction:column; gap:6px; }

    /* ===== Range styling cross-browser (Safari compreso) ===== */
    .range{
      -webkit-appearance: none; appearance: none;
      width: 180px; height: 28px; background: transparent; margin: 0;
    }
    /* WebKit track */
    .range::-webkit-slider-runnable-track{
      height: 8px;
      background: linear-gradient(90deg, rgba(255,215,0,.35), rgba(0,180,255,.25));
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.15);
    }
    /* WebKit thumb */
    .range::-webkit-slider-thumb{
      -webkit-appearance: none; width: 18px; height: 18px; margin-top: -6px;
      border-radius: 50%; background: #fff; border: 2px solid var(--gold);
      box-shadow: 0 0 8px rgba(255,215,0,.45);
    }
    /* Firefox */
    .range::-moz-range-track{
      height: 8px;
      background: linear-gradient(90deg, rgba(255,215,0,.35), rgba(0,180,255,.25));
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.15);
    }
    .range::-moz-range-thumb{
      width: 18px; height: 18px; border-radius: 50%;
      background:#fff; border: 2px solid var(--gold);
      box-shadow: 0 0 8px rgba(255,215,0,.45);
    }
    .range::-moz-range-progress{
      height: 8px; background: rgba(255,215,0,.45);
      border-radius: 999px 0 0 999px;
    }
    .range:focus{ outline:none; filter: drop-shadow(0 0 6px rgba(255,215,0,.35)); }

    /* Layer decorativi (se presenti) non devono mangiare i click */
    .galaxy, .stars, .stardust, .meteor-shower,
    .planet, .planet-ring, .star, .meteor, .supernova, .particle { pointer-events: none !important; }

    @media (max-width: 980px){
      #thunder-controls{ display:flex !important; left:10px; top:auto; bottom: 16px; }
      .slider-wrap{ grid-template-columns: 1fr; }
      main{ padding-bottom: 100px; }
    }
  </style>
</head>
<body>
  <a class="skip-link" href="#contenuto">Salta al contenuto</a>

  <main id="contenuto" role="main">
    <h1>Demo Safari: Slider verticale + Tuono</h1>
    <p class="lead">Questa pagina include le patch per Safari: <em>range</em> stilizzato, bottone ‚ÄúTuono‚Äù, audio con <code>playsinline</code>, e slider fluido con controllo velocit√†.</p>

    <div class="slider-wrap">
      <!-- SLIDER -->
      <div class="slider-vertical" id="slider">
        <div class="slider-inner" id="slides">
          <!--INIZIO FOTO SLIDER (OTTIMIZZATO)-->
          <div class="slide-vertical">
            <img alt="Socrate" width="260" height="340" loading="eager" fetchpriority="high" decoding="async"
                 src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/Socrates_Louvre.jpg">
            <p>Socrate</p>
          </div>
          <div class="slide-vertical">
            <img alt="Platone" width="260" height="340" loading="lazy" fetchpriority="low" decoding="async"
                 src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/platone.png">
            <p>Platone</p>
          </div>
          <div class="slide-vertical">
            <img alt="Aristotele" width="260" height="340" loading="lazy" fetchpriority="low" decoding="async"
                 src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/Aristotle_.jpg">
            <p>Aristotele</p>
          </div>
          <div class="slide-vertical">
            <img alt="Maria Teresa" width="260" height="340" loading="lazy" fetchpriority="low" decoding="async"
                 src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/maria_teresa.jpg">
            <p>üïØÔ∏èMaria Teresa: virt√π e bellezza in armonia‚úùÔ∏è</p>
          </div>
          <div class="slide-vertical">
            <img alt="Cartesio" width="260" height="340" loading="lazy" fetchpriority="low" decoding="async"
                 src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/cartesio.jpg">
            <p>Cartesio</p>
          </div>
          <div class="slide-vertical">
            <img alt="Kant" width="260" height="340" loading="lazy" fetchpriority="low" decoding="async"
                 src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/kant.webp">
            <p>Kant - il pi√π zoppo tra gli storpi del concetto</p>
          </div>
          <div class="slide-vertical">
            <img alt="San Tommaso" width="260" height="340" loading="lazy" fetchpriority="low" decoding="async"
                 src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/s.Tommaso.jpg">
            <p>San Tommaso</p>
          </div>
          <div class="slide-vertical">
            <img alt="Cerbero" width="260" height="340" loading="lazy" fetchpriority="low" decoding="async"
                 src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/cerbero.webp">
            <p>Cerbero - Guardiano dell'Ade</p>
          </div>
          <div class="slide-vertical">
            <img alt="Nietzsche" width="260" height="340" loading="lazy" fetchpriority="low" decoding="async"
                 src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/friedrich-nietzsche.jpg">
            <p>Nietzsche</p>
          </div>
          <div class="slide-vertical">
            <img alt="Livia" width="260" height="340" loading="lazy" fetchpriority="low" decoding="async"
                 src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/Livia.jpeg">
            <p>‚öñüëëìÉπLiviaü¶ÖDEAüêç egiziaüèõÔ∏èüî±</p>
          </div>
          <div class="slide-vertical">
            <img alt="Dea" width="260" height="340" loading="lazy" fetchpriority="low" decoding="async"
                 src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/dea.jpeg">
            <p>ìçùDivinit√† mesopotamica‚öØ</p>
          </div>
          <!-- ...puoi aggiungere altri slide come in origine... -->
          <!--FINE FOTO SLIDER (OTTIMIZZATO)-->
        </div>
      </div>

      <div>
        <p><strong>Controllo velocit√† slider</strong></p>
        <label class="speed-label" for="speed-range">
          Velocit√† (<span id="speed-val">1.0x</span>)
          <input id="speed-range" class="range" type="range" min="0.4" max="2.0" step="0.1" value="1.0" aria-label="Velocit√† scorrimento slider">
        </label>
      </div>
    </div>
  </main>

  <!-- Controllo tuono: fuori dallo slider -->
  <div id="thunder-controls" class="slider-controls" role="region" aria-label="Controllo tuono">
    <button id="btn-thunder" class="ctrl-btn" type="button">‚ö° Tuono</button>
  </div>

  <!-- Audio locale + fallback -->
  <audio id="thunder-sound" preload="auto" playsinline crossorigin="anonymous">
    <source src="https://casi0048.github.io/suoni/thunder-sound.mp3" type="audio/mpeg">
    <source src="https://cdn.pixabay.com/download/audio/2022/03/25/audio_f7efc7fc85.mp3" type="audio/mpeg">
  </audio>

  <script>
  // Stato/label sicuri per il tasto Tuono
  window.thunderOn = window.thunderOn ?? false;
  window.updateLabel = window.updateLabel || function(){
    const btn = document.getElementById('btn-thunder');
    if (!btn) return;
    btn.classList.toggle('active', !!window.thunderOn);
    btn.setAttribute('aria-pressed', window.thunderOn ? 'true' : 'false');
    btn.textContent = window.thunderOn ? '‚ö° Tuono: ON' : '‚ö° Tuono';
  };
  </script>

  <script>
  // Slider verticale minimo: animazione JS fluida con controllo velocit√†
  (function(){
    const container = document.getElementById('slider');
    const inner = document.getElementById('slides');
    if(!container || !inner) return;

    // Duplico i contenuti per scorrimento infinito
    inner.innerHTML = inner.innerHTML + inner.innerHTML;
    let offset = 0;
    let lastTs = performance.now();
    const baseSpeed = 25; // px/sec a 1.0x
    const speedInput = document.getElementById('speed-range');
    const speedValEl = document.getElementById('speed-val');
    let speedMult = parseFloat(speedInput?.value || '1');

    function loop(ts){
      const dt = Math.min(100, ts - lastTs) / 1000; // cap per tab in background
      lastTs = ts;
      const total = inner.scrollHeight / 2;
      offset += baseSpeed * speedMult * dt;
      if(offset >= total) offset = 0;
      inner.style.transform = 'translateY(' + (-offset) + 'px)';
      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);

    speedInput?.addEventListener('input', e=>{
      speedMult = parseFloat(e.target.value);
      if(speedValEl) speedValEl.textContent = speedMult.toFixed(1) + 'x';
    });
  })();
  </script>

  <script>
  // Tuono: aggancio robusto (Safari richiede un gesto utente per avviare l'audio)
  (function(){
    const btn = document.getElementById('btn-thunder');
    const audio = document.getElementById('thunder-sound');
    if(!btn) return;

    // Deduplica listeners
    const clone = btn.cloneNode(true);
    btn.parentNode.replaceChild(clone, btn);
    const thBtn = document.getElementById('btn-thunder');

    if (audio){
      try { audio.preload = 'auto'; audio.crossOrigin = audio.crossOrigin || 'anonymous'; } catch(_){}
      audio.addEventListener('error', () => {
        console.warn('Thunder audio non disponibile (403/CORS) ‚Üí OFF');
        window.thunderOn = false; window.updateLabel && window.updateLabel();
      });
      window.playThunderIfOn = window.playThunderIfOn || function(){
        if(window.thunderOn){
          try{ audio.currentTime = 0; audio.play().catch(()=>{}); }catch(_){}
        }
      };
    }

    thBtn.addEventListener('click', e => {
      e.preventDefault();
      window.thunderOn = !window.thunderOn;
      window.updateLabel && window.updateLabel();
      if(!audio) return;
      if(window.thunderOn){
        try{ audio.currentTime = 0; audio.play().catch(()=>{}); }catch(_){}
      }else{
        try{ audio.pause(); audio.currentTime = 0; }catch(_){}
      }
    });

    window.updateLabel && window.updateLabel();
  })();
  </script>
</body>
</html>
