<!DOCTYPE html>
<html lang="it">
<head>
    <meta content="Echi di Sofia - Portale di filosofia antica, moderna e contemporanea con approfondimenti su autori e correnti filosofiche" name="description"/>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>Echi di Sofia — Slider laterale + Blob articoli</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&amp;family=Cinzel+Decorative:wght@700&amp;family=Cormorant+Garamond:wght@600&amp;family=EB+Garamond:ital,wght@0,400;0,500;1,400&amp;family=Montserrat:wght@300;400;600&amp;display=swap" rel="stylesheet"/>
    
    <!-- Favicon -->
    <link href="favicon_io/favicon-32x32.png" rel="icon" type="image/png"/>
    
    <!-- Icons -->
    <link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" referrerpolicy="no-referrer" rel="stylesheet"/>
    
    <!-- GSAP -->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    
    <style>
      :root{
        --bg:#0a0a1a;
        --gold:#d4af37;
        --cyan:#00ccff;
        --menu-bg:rgba(10,10,30,.98);
        --menu-border:rgba(255,215,0,.22);
        --glass:rgba(0,0,0,.35);
      }
      *{box-sizing:border-box}
      html,body{height:100%;margin:0}
      body{
        font-family:'Montserrat',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
        background:var(--bg); color:#e9eef5; overflow-x:hidden; min-height:100vh; display:flex; flex-direction:column;
      }
      a{color:#9ad0ff;text-decoration:none;transition:.25s}
      a:hover{color:#fff;text-shadow:0 0 6px #33ccff}
      
      /* Layers: nebula behind, stars/comets above it */
      #nebula{ position:fixed; top:0; left:0; z-index: -1; }
      #star-canvas{ position:fixed; top:0; left:0; z-index: 0; pointer-events:none; }
      
      /* Lightning overlay + bolt */
      #lightning{ position:fixed; inset:0; z-index:50; pointer-events:none; opacity:0;
        background:radial-gradient(circle at 50% 40%, rgba(255,255,255,.95), rgba(255,255,255,.22) 40%, transparent 65%);
        mix-blend-mode:screen; filter:blur(1px);
      }
      .bolt{ position:fixed; width:2px; height:160px; background:linear-gradient(#fff, rgba(255,255,255,.4));
        top:50%; left:50%; transform:translate(-50%,-50%) rotate(12deg) scaleY(0);
        box-shadow:0 0 18px rgba(255,255,255,.9); z-index:51; opacity:.9; }
      
      /* Top bar + logo + translate + search + buttons */
      .top-bar{
        position:fixed; top:14px; left:0; width:100%;
        display:flex; justify-content:center; align-items:center; gap:14px;
        padding:8px 12px; background:var(--glass);
        z-index:1000;
      }
      .brand{ display:flex; align-items:center; gap:10px; margin-right:10px; text-decoration:none; }
      .brand svg{ width:34px; height:34px; filter:drop-shadow(0 0 6px rgba(255,215,0,.5)) }
      .brand span{
        font-family:'Cinzel Decorative',cursive; font-weight:700; letter-spacing:.5px;
        background:linear-gradient(90deg,#ffd700,#fff7b0,#ffd700); -webkit-background-clip:text; background-clip:text; color:transparent;
        text-shadow:0 0 10px rgba(255,215,0,.35);
      }
      .bar-right{ display:flex; align-items:center; gap:10px; }
      #google_translate_element{ min-width: 160px; }
      .ctrl-btn{
        border:1px solid var(--menu-border); background:rgba(20,20,40,.75);
        color:#e9eef5; padding:.45rem .6rem; border-radius:6px; font-weight:600; cursor:pointer;
        transition:.2s; font-family:'Montserrat',sans-serif;
      }
      .ctrl-btn:hover{ color:#fff; box-shadow:0 0 10px rgba(255,215,0,.25) }
      .ctrl-btn:active{ transform: translateY(1px) }
      
      /* SEARCH BOX */
      .search-container input {
        width: 260px;
        max-width: 52vw;
        height: 40px;
        line-height: 40px!important;
        padding: 0 2.4rem 0 2.4rem;
        background: rgba(20,20,40,.78);
        border: 1px solid var(--menu-border);
        border-radius: 6px;
        color: #e0e0e0;
        font-weight: 300;
        font-size: .95rem;
        outline: none;
        transition: .25s;
        box-sizing: border-box;
      }
      .search-container input:focus{ border-color:rgba(255,215,0,.5); box-shadow:0 0 12px rgba(255,215,0,.18) }
      .search-icon{ position:absolute; left:.8rem; font-size:.95rem; color:rgba(255,215,0,.85) }
      
      header{ margin-top:76px; display:flex; justify-content:center; z-index:900 }
      .menu-container{ max-width:1200px; width:100%; padding:.4rem 1rem; }
      nav.menu-desktop ul{ display:flex; gap:1px; list-style:none; margin:0; padding:0; justify-content:center; white-space:nowrap }
      nav.menu-desktop li{ position:relative }
      .menu-btn, nav.menu-desktop li>a{
        display:inline-flex; flex-direction:column; align-items:center; gap:3px;
        background:none; border:none; cursor:pointer;
        color:#9ad0ff; font-family:'Cormorant Garamond',serif; font-weight:700; font-size:1.35rem;
        padding:.45rem .7rem; border-radius:6px; transition:.25s; text-decoration:none;
        text-shadow:0 0 6px #33ccff99;
      }
      .menu-btn:hover, nav.menu-desktop li>a:hover{ color:#fff }
      .arrow{ font-size:.75rem }
      .mega-menu{
        position:absolute; top:100%; left:50%; transform:translateX(-50%) translateY(10px);
        width:980px; max-width:94vw;
        background:var(--menu-bg);
        border:1px solid var(--menu-border); border-top:0;
        padding:14px; display:grid; grid-template-columns:repeat(4,1fr); gap:14px;
        box-shadow:0 15px 30px rgba(0,0,0,.4); backdrop-filter:blur(10px);
        opacity:0; visibility:hidden; pointer-events:none; transition:.3s; z-index:950;
      }
      li.dropdown:hover > .mega-menu,
      li.dropdown:focus-within > .mega-menu,
      .mega-menu:hover{ opacity:1; visibility:visible; pointer-events:auto; transform:translateX(-50%) translateY(0) }
      .mega-menu h4{ margin:.2rem 0 .4rem; font-size:1rem; color:var(--gold) }
      .mega-menu a{ display:block; color:#9ad0ff;font-weight: 700;  font-size:.95rem; padding:.12rem 0; }
      .mega-menu a:hover{ color:#fff; transform:translateX(3px) }
      
      /* QUOTES BAR sotto la barra del menu */
      .quotes-bar{
        position:relative; z-index:880;
        margin:10px auto 0; max-width:1200px; width:95%;
        background: rgba(0,0,0,0); border:1px solid rgba(255,215,0,.15);
        padding:10px 14px; border-radius:8px; text-align:center;
      }
      .quotes-bar .quote-text{ font-family:'EB Garamond',serif; font-size:1.12rem; font-style:italic; color: #00CFFF;font-weight: 700; }
      .quotes-bar .author{ margin-left:6px; color:#ffd86a; font-size:1rem }
      
      /* Welcome */
      .welcome-section{ padding:14px 16px 10px; text-align:center }
      .welcome-title{
        font-family:'Cinzel Decorative',cursive; font-weight:700; font-size:3.05rem;
        color:transparent; background:linear-gradient(90deg,#ffd700,#ffaa00,#fff7b0,#ffd700);
        -webkit-background-clip:text; background-clip:text;
        filter:drop-shadow(0 0 12px rgba(255,215,0,.35)); animation:titlePulse 6s infinite;
      }
      @keyframes titlePulse{ 0%,100%{ transform:scale(1)} 50%{ transform:scale(1.04)} }
      .welcome-subtitle{ margin-top:-20px; color:#9ad0ff; font-size:1.5rem }
      .typing-wrap{ margin-top:10px; display:flex; justify-content:center; }
      .typing-effect{ font-family:'EB Garamond',serif; font-size:1.4rem; font-style:italic; color:#00CFFF; font-weight: 700;  }
      .caret{ display:inline-block; width:1ch; }
      .caret::after{ content:"|"; animation: blink 1s infinite; opacity:.8 }
      @keyframes blink{ 0%,49%{opacity:.8} 50%,100%{opacity:0} }
      
      /* Exploding text */
      .exploding-text{ margin:16px auto 0; font-family:'EB Garamond',serif; font-size:1.25rem; font-style:italic;
        color:#e7f6ff; letter-spacing:.5px; display:inline-block; cursor:pointer; user-select:none; z-index:1;}
      .exploding-text .ch{ display:inline-block; will-change:transform,opacity }
      
      /* Particles (symbols) */
      #philoParticles{ position:fixed; inset:0; z-index:10; pointer-events:none; }
      .particle{ position:fixed; will-change:transform,opacity; user-select:none; white-space:nowrap;
        text-shadow:0 0 10px rgba(255,215,0,.35); opacity:.95; pointer-events:auto; cursor:default; }
      
      /* =====INIZIO SLIDER VERTICALE SINISTRA — STABILE ===== */   
      .slider-vertical{
        position: fixed;
        left: 52px;
        top: 120px;
        width: 180px;
        height: 320px;
        z-index: 930;
        overflow: hidden;
        border: 1px solid rgba(255,215,0,.18);
        border-radius: 12px;
        background: rgba(10,10,25,.45);
        backdrop-filter: blur(6px);
        box-shadow: 0 8px 24px rgba(0,0,0,.35);
      }
      .slider-vertical .slider-inner{
        position: absolute;
        inset: 0;
        will-change: transform;
      }
      .slide-vertical{
        width: 100%;
        padding: 10px 10px 14px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        box-sizing: border-box;
      }
      .slide-vertical img{
        width: 100%;
        height: 140px;
        object-fit: contain;
        display: block;
        background: rgba(0,0,0,.25);
        border-radius: 10px;
        border: 1px solid rgba(255,255,255,.1);
        box-shadow: 0 6px 14px rgba(0,0,0,.25);
      }
      .slide-vertical p{
        margin: .25rem 0 0;
        font-family: 'Cormorant Garamond', serif;
        font-size: .92rem;
        text-align: center;
        color: #ffe9b8;
        text-shadow: 0 0 8px rgba(255,215,0,.25);
        min-height: 2.6em;
        line-height: 1.3;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
      
      /* ===== BLOB ANIMATO DESTRA (Ultimi articoli) ===== */
      .articles-blob{
        position:fixed; right:14px; top:250px; width:300px; max-width:32vw; z-index:930;
        padding:14px 16px; color:  #e9eef5;                      
        border:1px solid rgba(255,215,0,.18);border-radius:45% 55% 50% 50%/55% 45% 55% 45%;
        background: radial-gradient(120% 120% at 10% 10%, rgba(255,215,0,.18), rgba(0,180,255,.14) 40%, rgba(0,0,0,.38) 78%);
        box-shadow:0 10px 30px rgba(0,0,0,.4), inset 0 0 24px rgba(0,140,255,.15);
        animation: blobMorph 14s ease-in-out infinite;
        backdrop-filter: blur(8px);
      }
      @keyframes blobMorph{
        0%{ transform:scale(1) translateY(0); border-radius:45% 55% 50% 50%/55% 45% 55% 45%; }
        33%{ transform:scale(1.02) translateY(-3px); border-radius:55% 45% 45% 55%/45% 55% 45% 55%; }
        66%{ transform:scale(0.98) translateY(2px); border-radius:52% 48% 58% 42%/48% 52% 48% 52%; }
        100%{ transform:scale(1) translateY(0); border-radius:45% 55% 50% 50%/55% 45% 55% 45%; }
      }
      .articles-blob h3{
        margin:.2rem 0 .5rem; font-family:'Cinzel',serif; letter-spacing:.3px; color:#ffd86a; font-size:1.1rem;
        text-shadow: 0 0 10px rgba(255,215,0,.35);
      }
      .articles-blob ul{ list-style:none; padding:0; margin:0; max-height:300px; overflow:auto }
      .articles-blob li{ margin:.35rem 0; display:flex; align-items:center; gap:8px }
      .articles-blob li i{ opacity:.9 }
      .articles-blob a{ color:#cfe8ff; font-weight:700; }
      .articles-blob a:hover{ color:#fff }
      
      footer{ margin-top:auto; background:#000; color:#fff; text-align:center; padding:24px }
      
      /* Mobile: nascondo elementi laterali per spazio */
      @media (max-width: 980px){
        .slider-vertical, .articles-blob{ display:none }
        .welcome-title{ font-size:2.3rem }
        .mega-menu{ grid-template-columns:repeat(2,1fr) }
        .bar-right{ gap:6px }
        #google_translate_element{ min-width:120px }
        .ctrl-btn{ padding:.35rem .5rem }
        .quotes-bar{ width:92% }
      }
      
      /* INIZIO AGGIUNTE RESTRINGIMENTO COLONNE SUBMENU */
      .menu-desktop .mega-menu.columns-4{
        width: 700px !important;
        grid-template-columns: repeat(4, 200px) !important;
        gap: 8px 12px !important;
        padding: 10px 12px !important;
      }
      .menu-desktop .mega-menu.columns-4 > div{
        padding: 4px 6px;
        max-height: 450px;
        overflow: auto;
      }
      .menu-desktop .mega-menu.columns-4 > div h4{
        margin: 0 0 6px;
        font-size: .95rem;
      }
      .menu-desktop .mega-menu.columns-4 > div a{
        margin: 2px 0;
        font-size: .92rem;
        line-height: 1.25;
      }
      
      /* === 1) IL MENU SOPRA A TUTTO === */
      header,
      .menu-container,
      nav.menu-desktop{
        position: relative !important;
        z-index: 9999 !important;
      }
      .menu-desktop .mega-menu{
        z-index: 10000 !important;
      }
      
      /* === 2) COLORE PANNELLO + COLONNE === */
      .menu-desktop .mega-menu{
        background: rgba(8, 18, 40, 0.98) !important;
        border: 1px solid rgba(255, 215, 0, 0.28) !important;
        box-shadow: 0 18px 40px rgba(0,0,0,.55) !important;
      }
      .menu-desktop .mega-menu.columns-4 > div{
        background: rgba(3, 10, 24, 0.92) !important;
        border: 1px solid rgba(255,255,255,0.06) !important;
        border-radius: 8px !important;
        padding: 8px 10px !important;
      }
      
      /* === 3) COLONNE PIÙ STRETTE (opzionale ma utile) === */
      .menu-desktop .mega-menu.columns-4{
        width: 820px !important;
        grid-template-columns: repeat(4, 180px) !important;
        gap: 10px 12px !important;
        padding: 12px !important;
      }
      
      /* === 4) TESTO DENTRO LE COLONNE (leggibilità) === */
      .menu-desktop .mega-menu.columns-4 > div h4{
        color: #ffd86a !important;
        margin: 0 0 6px !important;
        font-size: .95rem !important;
      }
      .menu-desktop .mega-menu.columns-4 > div a{
        color: #cfe8ff !important;
        font-size: .92rem !important;
        line-height: 1.25 !important;
      }
      .menu-desktop .mega-menu.columns-4 > div a:hover{
        color: #ffffff !important;
      }
      
      /* === 5) TUTTO IL RESTO SOTTO AL MENU (evita che lo coprano) === */
      .slider-vertical,
      .articles-blob,
      #russell-box, #russell-hint,
      #video-right,
      #audio-player{
        z-index: 900 !important;
      }
      
      /* --- Evita overflow orizzontale dei mega-menu --- */
      .menu-desktop .mega-menu{
        max-width: 100vw !important;
        box-sizing: border-box !important;
      }
      
      /* === FILOSOFIA ANTICA (2° li): aggancia a sinistra, apri verso destra/centro === */
      .menu-desktop > ul > li.dropdown:nth-child(2) > .mega-menu{
        left: 0 !important;
        right: auto !important;
        transform: translateY(10px) !important;
      }
      .menu-desktop > ul > li.dropdown:nth-child(2):hover > .mega-menu,
      .menu-desktop > ul > li.dropdown:nth-child(2):focus-within > .mega-menu,
      .menu-desktop > ul > li.dropdown:nth-child(2) > .mega-menu:hover{
        transform: translateY(0) !important;
      }
      
      /* === FILOSOFIA POLACCA (7° li): aggancia a destra, apri verso sinistra/centro === */
      .menu-desktop > ul > li.dropdown:nth-child(7) > .mega-menu{
        right: 0 !important;
        left: auto !important;
        transform: translateY(10px) !important;
      }
      .menu-desktop > ul > li.dropdown:nth-child(7):hover > .mega-menu,
      .menu-desktop > ul > li.dropdown:nth-child(7):focus-within > .mega-menu,
      .menu-desktop > ul > li.dropdown:nth-child(7) > .mega-menu:hover{
        transform: translateY(0) !important;
      }
      
      /* (Opzionale) dimensioni più contenute per tutte le versioni a 4 colonne */
      .menu-desktop .mega-menu.columns-4{
        width: min(880px, 94vw) !important;
        grid-template-columns: repeat(4, minmax(160px, 1fr)) !important;
        gap: 10px 12px !important;
      }
      
      /* === SOLO: larghezza colonne dei mega-menu a 4 colonne === */
      .menu-desktop .mega-menu.columns-4{
        width: max-content !important;
        max-width: 96vw !important;
        grid-template-columns: repeat(4, minmax(230px, 1fr)) !important;
      }
      .menu-desktop .mega-menu.columns-4 > div{
        min-width: 220px !important;
      }
      
      /* === FX HOVER per i link del mega-menu: freccetta + evidenza === */
      .menu-desktop .mega-menu a{
        position: relative;
        display: block;
        padding: .14rem 22px .14rem 10px;
        border-radius: 6px;
        background-image: linear-gradient(90deg, rgba(255,215,0,.14), rgba(0,180,255,.12));
        background-size: 0% 100%;
        background-repeat: no-repeat;
        transition: background-size .25s ease, transform .18s ease, color .18s ease, box-shadow .18s ease;
      }
      .menu-desktop .mega-menu a::after{
        content: "›";
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%) translateX(-6px);
        opacity: 0;
        font-size: .95em;
        color: #ffd86a;
        transition: transform .22s ease, opacity .22s ease;
      }
      .menu-desktop .mega-menu a:hover,
      .menu-desktop .mega-menu a:focus{
        color: #fff;
        transform: translateX(2px);
        background-size: 100% 100%;
        box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
        outline: none;
      }
      .menu-desktop .mega-menu a:hover::after,
      .menu-desktop .mega-menu a:focus::after{
        opacity: 1;
        transform: translateY(-50%) translateX(0);
      }
      
      /* Focus tastiera ben visibile */
      .menu-desktop .mega-menu a:focus-visible{
        box-shadow: 0 0 0 2px rgba(255,215,0,.45);
        border-radius: 6px;
      }
      
      /* Opzionale: stato "attivo" se vuoi segnare la pagina corrente */
      .menu-desktop .mega-menu a.is-active{
        background-size: 100% 100%;
        color: #fff;
      }
      
      /* === PALETTE B: VERDE PETROLIO ELEGANTE === */
      .menu-desktop .mega-menu{
        background: rgba(6, 28, 30, 0.98) !important;
        border-color: rgba(95, 224, 197, 0.24) !important;
        box-shadow: 0 22px 45px rgba(0,0,0,.55) !important;
      }
      .menu-desktop .mega-menu.columns-4 > div{
        background: rgba(8, 36, 38, 0.94) !important;
        border: 1px solid rgba(255,255,255,0.06) !important;
        border-radius: 8px !important;
      }
      
      /* I link #cfe8ff restano ben leggibili su petrolio */
      .menu-desktop .mega-menu,
      .menu-desktop .mega-menu.columns-4 > div{
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
      }
      
      .ctrl-btn.active{
        border-color:#ffd86a;
        box-shadow:0 0 18px rgba(255,215,0,.45), inset 0 0 10px rgba(255,215,0,.25);
      }
      
      /* Exploding text animation */
      .exploding-text.explode{ animation: explodeAnim 1.2s forwards; }
      @keyframes explodeAnim{
        0%{ opacity:1; transform: scale(1); }
        50%{ opacity:.7; transform: scale(1.4) rotate(5deg); }
        100%{ opacity:1; transform: scale(1); }
      }
      
      /* Blob vivace ma fluido */
      .articles-blob{
        animation: blobMorphSmooth 12s cubic-bezier(.55,.2,.45,.8) infinite !important;
        will-change: transform, border-radius;
      }
      @keyframes blobMorphSmooth{
        0%{   transform:scale(1) translateY(0);
        border-radius:45% 55% 50% 50%/55% 45% 55% 45%; }
        33%{  transform:scale(1.03) translateY(-4px);
        border-radius:55% 45% 47% 53%/47% 53% 47% 53%; }
        66%{  transform:scale(0.97) translateY(4px);
        border-radius:50% 50% 53% 47%/53% 47% 53% 47%; }
        100%{ transform:scale(1) translateY(0);
        border-radius:45% 55% 50% 50%/55% 45% 55% 45%; }
      }
      
      /* PATCH SAFARI: controlli Tuono (visibilità) */
      #thunder-controls{ position:fixed; left:52px; top:420px; z-index:9999; display:flex; }
      #thunder-controls .ctrl-btn{ display:inline-flex; align-items:center; justify-content:center; min-width:44px; padding:6px 10px; border-radius:8px; border:1px solid rgba(255,215,0,.25); background:rgba(20,20,40,.7); color:#ffd86a; font-weight:600; cursor:pointer; }
      @media (max-width:980px){ #thunder-controls{ display:flex !important; left:10px; top:auto; bottom:16px; } }
      
      /* Fix conservativi per click footer e link */
      .galaxy,
      .stars,
      .stardust,
      .meteor-shower,
      .planet,
      .planet-ring,
      .star,
      .meteor,
      .supernova,
      .particle {
        pointer-events: none !important;
      }
      
      /* Dizionario filosofico — CLICK-SAFE (senza JS), compatto */
      .edx-dict{
        background:rgba(10,10,30,.9);
        border:1px solid rgba(255,215,0,.35);
        border-radius:10px;
        box-shadow:0 6px 14px rgba(0,0,0,.28);
        margin: 8px 0;
        position:relative; z-index:1;
      }
      .edx-dict[open] { box-shadow:0 8px 18px rgba(0,0,0,.35); }
      .edx-dict__head{
        list-style:none;
        display:flex; align-items:center; gap:10px;
        padding:4px 8px; cursor:pointer; user-select:none; min-height:26px;
      }
      .edx-dict__head::-webkit-details-marker{ display:none }
      .edx-dict__title{ font-family:'Cinzel',serif; color:#ffd86a; font-weight:700; font-size:.9rem;}
      .edx-dict__chev{ margin-left:auto; font-size:.85rem; color:#e9eef5; transition:transform .2s ease; }
      .edx-dict[open] .edx-dict__chev{ transform:rotate(180deg) }
      .edx-dict__body{ border-top:1px solid rgba(255,255,255,.08); padding:6px 8px; }
      .edx-dict__controls{ display:flex; gap:6px; align-items:center; }
      .edx-dict__controls input[name="query"]{
        box-sizing:border-box; flex:1; min-width:160px;
        height:22px; line-height:22px; padding:0 .55rem;
        background:rgba(20,20,40,.78);
        border:1px solid rgba(255,215,0,.28);
        border-radius:6px; color:#e9eef5; font-size:.85rem;
      }
      .edx-dict__controls button[type="submit"]{
        appearance:none; -webkit-appearance:none;
        box-sizing:border-box; display:inline-flex; align-items:center; justify-content:center;
        height:22px; padding:0 .45rem; line-height:1; font-size:.8rem;
        border:1px solid rgba(255,215,0,.28);
        background:rgba(255,255,255,.06);
        color:#e9eef5; border-radius:6px; cursor:pointer;
      }
      @media (max-width:980px){ .edx-dict{ display:none } }
      
      /* Stile per la tendina delle fonti */
      .edx-dict__select {
        background: rgba(20,20,40,.85);
        color: #ffd86a;
        border: 1px solid rgba(255,215,0,.35);
        border-radius: 6px;
        padding: 2px 6px;
        font-size: .85rem;
        font-family: 'Cinzel', serif;
        cursor: pointer;
      }
      
      /* Colori anche quando si apre la lista */
      .edx-dict__select option {
        background: rgba(10,10,30,.95);
        color: #e9eef5;
      }
      
      /* ===== CONTROLLI SLIDER VERTICALE — Eleganti e coerenti ===== */
      .slider-controls{
        position: fixed;
        left: 52px;
        top: 460px;
        width: 180px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        background: rgba(10,10,25,.55);
        border: 1px solid rgba(255,215,0,.18);
        border-radius: 12px;
        padding: 10px;
        box-shadow: 0 6px 16px rgba(0,0,0,.35);
        z-index: 930;
      }
      .slider-controls .ctrl-btn{
        background: rgba(20,20,40,.7);
        border: 1px solid rgba(255,215,0,.25);
        border-radius: 8px;
        color: #ffd86a;
        font-weight: 600;
        cursor: pointer;
        padding: 6px;
        transition: all .2s;
        font-family: 'Montserrat', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      }
      .slider-controls .ctrl-btn:hover{
        background: rgba(255,215,0,.15);
        box-shadow: 0 0 8px rgba(255,215,0,.4);
      }
      .slider-controls .speed-label{
        display:flex; flex-direction:column;
        font-size:.8rem; color:#cfe8ff;
        font-family:'Montserrat',sans-serif;
        gap:4px;
      }
      .slider-controls input[type=range]{
        width:100%;
        accent-color:#ffd86a;
      }
      @media (max-width: 980px){
        .slider-controls{ display:none; }
      }
      
      /* Didascalie leggibili e immagini pulite nello slider */
      .slider-vertical .slide-vertical p{
        background: linear-gradient(to bottom, rgba(0,0,0,.35), rgba(0,0,0,.35));
        padding: 4px 6px;
        border-radius: 6px;
      }
      .slider-vertical .slide-vertical img{
        object-fit: contain;
        background: rgba(0,0,0,.35);
      }
      
      /* === AUDIO-PLAYER RANGE: colore azzurro, nessuna ombra (Safari incluso) === */
      .audio-player input[type="range"]{
        -webkit-appearance: none; appearance: none;
        width: 120px; height: 28px; background: transparent; margin: 0; border: 0;
      }
      /* Track (WebKit: Safari/Chrome) */
      .audio-player input[type="range"]::-webkit-slider-runnable-track{
        height: 6px; background: #199cff; border: none; border-radius: 999px;
      }
      /* Thumb (WebKit) */
      .audio-player input[type="range"]::-webkit-slider-thumb{
        -webkit-appearance: none;
        width: 16px; height: 16px; margin-top: -5px;
        background: #fff; border: 2px solid #199cff; border-radius: 50%; box-shadow: none;
      }
      /* Firefox */
      .audio-player input[type="range"]::-moz-range-track{
        height: 6px; background: #199cff; border: none; border-radius: 999px;
      }
      .audio-player input[type="range"]::-moz-range-thumb{
        width: 16px; height: 16px; background: #fff; border: 2px solid #199cff; border-radius: 50%; box-shadow: none;
      }
      .audio-player input[type="range"]::-moz-range-progress{
        height: 6px; background: #199cff; border-radius: 999px 0 0 999px;
      }
      
      /* === COOKIE BANNER & MODAL (Echi di Sofia) === */
      .cookie-banner{
        position:fixed; left:50%; bottom:12px; transform:translateX(-50%);
        width:min(980px,92vw);
        background:rgba(10,10,30,.95);
        border:1px solid rgba(255,215,0,.28);
        box-shadow:0 20px 40px rgba(0,0,0,.45);
        backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px);
        padding:12px 14px; border-radius:12px;
        display:flex; align-items:center; gap:12px;
        z-index:20000;
      }
      .cookie-banner .cookie-text{ flex:1; font-size:.95rem; line-height:1.45; color:#cfe8ff }
      .cookie-banner .cookie-text a{ color:var(--gold,#d4af37); text-decoration:underline }
      .cookie-actions{ display:flex; gap:8px; flex-wrap:wrap }
      .btn{ 
        border-radius:8px; padding:.55rem .8rem; font-weight:600; cursor:pointer;
        font-family:'Montserrat',system-ui,Arial,sans-serif; border:1px solid transparent;
      }
      .btn.solid{ 
        background:linear-gradient(90deg,#ffd86a,#ffb100); color:#000;
        border-color:rgba(255,215,0,.6);
      }
      .btn.outline{
        background:rgba(0,0,0,.2); color:#cfe8ff; border-color:rgba(0,180,255,.5);
      }
      .btn.ghost{
        background:transparent; color:#cfe8ff; border-color:rgba(255,255,255,.2);
      }
      .btn:hover{ filter:brightness(1.08) }
      
      /* Modal overlay */
      .cookie-modal{ position:fixed; inset:0; background:rgba(0,0,0,.6);
        display:none; align-items:center; justify-content:center; padding:16px;
        z-index:999999;
      }
      .cookie-modal[aria-hidden="false"]{ display:flex }
      .cookie-modal__panel{
        width:min(640px,92vw); background:rgba(10,10,30,.98);
        border:1px solid rgba(255,215,0,.28); border-radius:14px; padding:16px 16px 12px;
        position:relative; color:#e9eef5;
      }
      .cookie-modal__panel h3{ margin:0 0 .25rem; color:#ffd86a; font-family:'Cinzel',serif; font-size:1.15rem }
      .cookie-modal__panel .muted{ opacity:.85; font-size:.95rem; margin:.15rem 0 .6rem }
      .cookie-list{ list-style:none; margin:.2rem 0 .6rem; padding:0; display:grid; gap:.45rem }
      .cookie-list li label{ display:flex; align-items:center; gap:.5rem; cursor:pointer }
      .cookie-list small{ display:block; margin-left:1.6rem; opacity:.75; font-size:.85rem }
      .cookie-modal__actions{ display:flex; justify-content:flex-end; gap:10px; margin-top:.6rem }
      .cookie-close{
        position:absolute; top:8px; right:10px; width:34px; height:34px; border-radius:8px;
        background:rgba(255,255,255,.06); color:#fff; border:1px solid rgba(255,255,255,.15);
        cursor:pointer; font-size:20px; line-height:1;
      }
      .cookie-close:hover{ background:rgba(255,255,255,.12) }
      
      /* Pulsante flottante per riaprire preferenze */
      .cookie-manage{
        position:fixed; left:50%; bottom:8px; transform:translateX(-50%);
        background:rgba(10,10,30,.8); color:#cfe8ff;
        border:1px solid rgba(255,215,0,.28); border-radius:999px;
        padding:.35rem .7rem; font-size:.85rem; backdrop-filter:blur(6px);
        z-index:20001;
      }
      
      /* Riduci movimento se preferito dal sistema */
      @media (prefers-reduced-motion: reduce){
        .cookie-banner, .cookie-modal, .cookie-manage{ transition:none }
      }
      
      /* FINE AGGIUNTE RESTRINGIMENTO COLONNE SUBMENU */
      
      /* Pulsante Tuono */
      #play-thunder {
        min-width: 60px;
        min-height: 44px!important;
        padding: 0.6rem 1.2rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        user-select: none;
      }
      
      /* Pulsante Esplodi */
      #explode-btn {
        min-width: 60px;
        min-height: 44px!important;
        padding: 0.6rem 1.2rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        user-select: none;
      }
      
      /* Fallback font per simboli/emoji */
      .particle, .symbol-rotator{
        font-family: system-ui, "Segoe UI", Roboto, "Noto Sans", "Noto Sans Symbols 2",
        "DejaVu Sans", Symbola, "Apple Color Emoji", "Segoe UI Emoji",
        "Twemoji Mozilla", sans-serif;
      }
      
      /* === MENU FIXED UNDER TOP BAR === */
      header {
        margin-top: 76px !important;
        padding-bottom: 68px !important;
        display: flex;
        justify-content: center;
        z-index: 900;
      }
      .menu-container {
        max-width: 1200px;
        width: 100%;
        padding: .4rem 1rem;
        position: fixed !important;
        top: 76px !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
        z-index: 999 !important;
        background: rgba(0,0,0,0.85) !important;
        margin-top: 0 !important;
      }
      
      /* === SEARCH: caret centered + larger clickable area + stable clear === */
      .search-container{ position:relative; display:flex; align-items:center; }
      .search-container input {
        height: 40px !important;
        line-height: 40px !important;
        padding: 0 2.6rem 0 3rem !important;
        box-sizing: border-box !important;
      }
      
      /* INIZIO COSMO DINAMICO*/
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: radial-gradient(ellipse at center, #000000 0%, #0F0F2D 70%, #1A1A4A 100%);
        height: 100vh;
      }
      /* Vortice galattico centrale */
      .galaxy {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80vmin;
        height: 80vmin;
        background: radial-gradient(circle, transparent 60%, rgba(138, 43, 226, 0.15) 100%);
        border-radius: 50%;
        animation: spin 120s linear infinite;
        z-index: 1;
      }
      .galaxy::before {
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        background: 
          radial-gradient(circle at 30% 30%, rgba(75, 0, 130, 0.3) 0%, transparent 50%),
          radial-gradient(circle at 70% 70%, rgba(106, 90, 205, 0.3) 0%, transparent 50%);
        border-radius: 50%;
        animation: pulse 20s infinite alternate;
      }
      @keyframes spin {
        100% { transform: translate(-50%, -50%) rotate(360deg); }
      }
      @keyframes pulse {
        0% { opacity: 0.3; }
        100% { opacity: 0.7; }
      }
      /* Stelle base */
      .stars {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 7;
      }
      .star {
        position: absolute;
        background: white;
        border-radius: 50%;
        animation: twinkle var(--duration) infinite ease-in-out;
      }
      @keyframes twinkle {
        0%, 100% { opacity: 0.3; transform: scale(1); }
        50% { opacity: 1; transform: scale(1.2); }
      }
      /* Stelle esplosive (supernove) */
      .supernova {
        position: absolute;
        border-radius: 50%;
        pointer-events: none;
        z-index: 3;
        animation: explode 4s forwards;
        opacity: 0;
      }
      @keyframes explode {
        0% { transform: scale(0); opacity: 0; }
        20% { transform: scale(1); opacity: 0.8; }
        100% { transform: scale(3); opacity: 0; }
      }
      .planet-ring {
        position: absolute;
        border-radius: 50%;
        border: 2px solid transparent;
        border-top-color: rgba(255, 215, 0, 0.6);
        transform-origin: center;
        animation: spin-ring linear infinite;
      }
      @keyframes spin-ring {
        100% { transform: rotate(360deg); }
      }
      /* Sciami meteorici */
      .meteor-shower {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 4;
        pointer-events: none;
      }
      .meteor {
        position: absolute;
        width: 3px;
        height: 3px;
        border-radius: 50%;
        animation: meteor linear infinite;
      }
      .meteor::before {
        content: '';
        position: absolute;
        width: 150px;
        height: 2px;
        background: linear-gradient(90deg, rgba(255,255,255,1), rgba(255,255,255,0));
        transform-origin: left center;
        transform: rotate(-30deg);
        filter: drop-shadow(0 0 5px white);
      }
      @keyframes meteor {
        0% {
          transform: translateX(var(--start-x)) translateY(var(--start-y));
          opacity: 0;
        }
        10% {
          opacity: 1;
        }
        100% {
          transform: translateX(var(--end-x)) translateY(var(--end-y));
          opacity: 0;
        }
      }
      /* Polvere stellare */
      .stardust {
        position: absolute;
        width: 100%;
        height: 100%;
        z-index: 999;
      }
      .particle {
        position: absolute;
        width: 1px;
        height: 1px;
        background: white;
        border-radius: 50%;
        animation: float-particle linear infinite;
        opacity: 0.5;
      }
      @keyframes float-particle {
        0% { transform: translateY(0) translateX(0); opacity: 0; }
        20% { opacity: 0.7; }
        100% { transform: translateY(-100vh) translateX(50px); opacity: 0; }
      }
      /*FINE COSMO DINAMICO*/
      
      /*  inizio  aggiunta stelle cadenti da destra a sinistra*/
      body {
        margin: 0;
        background: black;
        overflow: hidden;
      }
      canvas {
        position: fixed;
        top: 0; left: 0;
        width: 100vw; height: 100vh;
        display: block;
      }
      /*  fine  aggiunta stelle cadenti da destra a sinistra*/
      
      /* Dizionario filosofico — multi-fonte, compatto */
      .edx-dict{
        background:rgba(10,10,30,.9); border:1px solid rgba(255,215,0,.35);
        border-radius:10px; box-shadow:0 6px 14px rgba(0,0,0,.28);
        margin:16px 0 32px; position:relative; z-index:10;
      }
      .edx-dict[open]{ box-shadow:0 8px 18px rgba(0,0,0,.35) }
      .edx-dict__head{
        list-style:none; display:flex; align-items:center; gap:10px;
        padding:4px 8px; cursor:pointer; user-select:none; min-height:26px;
      }
      .edx-dict__head::-webkit-details-marker{ display:none }
      .edx-dict__title{ font-family:'Cinzel',serif; color:#ffd86a; font-weight:700; font-size:.9rem }
      .edx-dict__chev{ margin-left:auto; font-size:.85rem; color:#e9eef5; transition:transform .2s ease }
      .edx-dict[open] .edx-dict__chev{ transform:rotate(180deg) }
      .edx-dict__body{ border-top:1px solid rgba(255,255,255,.08); padding:6px 8px }
      .edx-dict__controls{ display:flex; gap:6px; align-items:center; flex-wrap:wrap }
      .edx-dict__select{
        height:22px; padding:0 .4rem; font-size:.8rem;
        border:1px solid rgba(255,215,0,.28); border-radius:6px;
        background:rgba(255,255,255,.06); color:#e9eef5;
      }
      .edx-dict__input{
        flex:1; min-width:150px; height:22px; line-height:22px; padding:0 .55rem;
        background:rgba(20,20,40,.78); border:1px solid rgba(255,215,0,.28);
        border-radius:6px; color:#e9eef5; font-size:.85rem; box-sizing:border-box;
      }
      .edx-dict__btn{
        appearance:none; -webkit-appearance:none; display:inline-flex; align-items:center; justify-content:center;
        height:22px; padding:0 .45rem; line-height:1; font-size:.8rem;
        border:1px solid rgba(255,215,0,.28); border-radius:6px; cursor:pointer;
        background:rgba(255,255,255,.06); color:#e9eef5;
      }
      /* garantisci apri/chiudi con <details> */
      .edx-dict .edx-dict__body{ display:none } .edx-dict[open] .edx-dict__body{ display:block }
      /* se è subito sopra un iframe, tieni aria e blocca click quando aperto */
      .edx-dict[open]+iframe{ pointer-events:none; margin-top:12px; filter:opacity(.85) }
      /* stacco definitivo sotto anche se altri CSS sovrascrivono */
      body .edx-dict{ margin-bottom:32px !important; }
      @media (max-width:980px){ .edx-dict{ display:none } }
      
      /* Mini player */
      .audio-player {
        position: fixed;
        bottom: 220px;
        left: 45px;
        background: rgba(10, 10, 30, 0.85);
        color: #aef;
        border: 1px solid #3cf;
        border-radius: 12px;
        padding: 10px 16px;
        font-family: 'Georgia', serif;
        font-size: 14px;
        z-index: 1200;
        box-shadow: 0 0 12px #3cf;
        display: flex;
        align-items: center;
        gap: 10px;
        opacity: 1;
        transform: none;
      }
      /* Titolo sopra il player */
      .audio-title {
        position: fixed;
        left: 80px;
        bottom: calc(220px + 50px);
        font-family: 'Georgia', serif;
        font-size: 13px;
        color: #ffd700;
        text-shadow: 0 0 6px rgba(0,0,0,0.6);
        z-index: 1201;
        pointer-events: none;
      }
      /* Compattezza bottoni */
      #audio-player, .audio-player{
        --btn-size: 28px;
        --gap: 6px;
        --pad-y: 6px;
        --pad-x: 10px;
        gap: var(--gap);
        padding: var(--pad-y) var(--pad-x);
      }
      #audio-player button,
      .audio-player button{
        display: inline-grid;
        place-items: center;
        width: var(--btn-size);
        height: var(--btn-size);
        padding: 0;
        line-height: 1;
        font-size: calc(var(--btn-size) * 0.65);
      }
      .audio-player button:hover{ transform: none; }
      /* Controlli */
      .audio-player .controls{ display:flex; align-items:center; gap:10px; }
      .audio-player input[type="range"]{ width: 70px; }
      /* Mobile: nascondi il player */
      @media (max-width: 980px){
        #audio-player, .audio-title{ display:none; }
      }
      
      /* Box Bertrand Russell */
      #russell-box {
        position: fixed;
        bottom: 40px;
        left: 30px;
        z-index: 9999;
        max-width: 220px;
        font-size: 1.05rem;
      }
      #russell-btn {
        background-color: #1c1c57;
        color: #ffffff;
        border: 2px solid #00d9ff;
        padding: 1rem 1.1rem;
        border-radius: 15px;
        cursor: pointer;
        text-align: left;
        line-height: 1.35;
        box-shadow: 0 0 10px rgba(0, 217, 255, 0.7);
        width: 100%;
        transition: all 0.3s ease;
        font-family: 'Georgia', serif;
      }
      #russell-btn:hover {
        background-color: #00d9ff;
        color: #0a0a3c;
        box-shadow: 0 0 25px rgba(0,255,255,1);
      }
      #russell-hint {
        margin-top: 6px;
        font-size: 0.8rem;
        color: #aadfff;
        text-align: left;
        max-width: 320px;
        position: fixed;
        bottom: 190px;
        left: 50px;
        user-select: none;
        font-style: italic;
        font-family: 'Segoe UI', sans-serif;
        z-index: 9998;
      }
      @media (max-width: 980px) {
        #russell-box, #russell-hint { display:none; }
      }
      
      /* Video container */
      .video-container{
        position: fixed;
        bottom: 60px;
        right: 80px;
        width: 280px;
        z-index: 99;
        padding: 8px;
        border-radius: 12px;
        background-color: rgba(14, 14, 14, 0.4);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        box-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
        transition: transform 0.3s ease;
      }
      .video-container:hover{ transform: scale(1.02); }
      .video-container iframe{
        width:100%;
        height:180px;
        border:none;
        border-radius:8px;
      }
      /* PLAYER sinistra (sotto lo slider) */
      .video-container-left{
        position: fixed;
        left: 12px;
        top: 460px;
        width: 200px;
        z-index: 99;
        padding: 6px;
        border-radius: 12px;
        background-color: rgba(14, 14, 14, 0.4);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        box-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
        transition: transform 0.3s ease;
      }
      .video-container-left:hover{ transform: scale(1.02); }
      .video-container-left iframe{
        width:100%;
        height:110px;
        border:none;
        border-radius:8px;
      }
      @media (max-width: 980px){
        .video-container-left{ display:none; }
        .video-container{ right: 12px; bottom: 12px; width: 70vw; }
      }
      
      /* Footer migliorato */
      footer {
        background: #06060d;
        color: #e9eef5;
        margin-top: 15px;
        position: relative;
        z-index: 0;
      }
      footer::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 1px;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 215, 0, 0.4),
          transparent
        );
      }
      .footer-wrap {
        max-width: 1200px;
        margin: 0 auto;
        padding: 28px 16px;
      }
      .footer-columns {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr;
        gap: 22px;
        align-items: start;
        text-align: left;
      }
      .footer-columns h3,
      .footer-columns h4 {
        margin: 0.2rem 0 0.6rem;
        color: #ffd86a;
        font-family: 'Cinzel', serif;
        letter-spacing: 0.3px;
      }
      .footer-columns p {
        margin: 0.2rem 0;
        color: #00bb2d;
        line-height: 1.6;
      }
      .footer-columns ul {
        list-style: none;
        margin: 0;
        padding: 0;
      }
      .footer-columns li {
        margin: 0.25rem 0;
      }
      .footer-columns a {
        color:   #9ad0ff;     
        font-weight: 700;
        text-decoration: none;
      }
      .footer-columns a:hover {
        color: #ffffff;
      }
      .social {
        margin-top: 0.6rem;
        display: flex;
        gap: 10px;
      }
      .social a {
        display: inline-flex;
        width: 36px;
        height: 36px;
        align-items: center;
        justify-content: center;
        border: 1px solid rgba(255, 215, 0, 0.25);
        border-radius: 50%;
        background: rgba(0, 0, 0, 0.25);
      }
      .social a:hover {
        box-shadow: 0 0 12px rgba(255, 215, 0, 0.25);
      }
      .footer-legal {
        margin-top: 16px;
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
        opacity: 0.9;
      }
      .footer-legal .dot {
        opacity: 0.5;
      }
      @media (max-width: 980px) {
        .footer-columns {
          grid-template-columns: 1fr;
          gap: 14px;
        }
      }
    </style>
</head>

<body>
    <!-- GALASSIA dietro -->
    <canvas id="nebula"></canvas>
    
    <!-- Stelle + Comete sopra la galassia -->
    <canvas id="star-canvas"></canvas>
    
    <!-- Lightning overlay -->
    <div id="lightning"></div>
    <div aria-hidden="true" class="bolt" id="bolt"></div>
    
    <!-- Top bar -->
    <div class="top-bar">
        <a aria-label="Home" class="brand" href="#">
            <svg aria-hidden="true" role="img" viewBox="0 0 64 64">
                <circle cx="32" cy="32" fill="none" r="30" stroke="#ffd700" stroke-width="2"></circle>
                <path d="M18 40 Q32 12 46 40" fill="none" stroke="#ffd700" stroke-width="2"></path>
                <circle cx="32" cy="28" fill="#ffd700" r="3"></circle>
            </svg>
            <span>Echi di Sofia</span>
        </a>
        
        <!-- ⬇️ BARRA DESTRA (traduttore + cerca + pulsanti) -->
        <div class="bar-right">
            <div class="translate-box">
                <span>🌐</span>
                <select aria-label="Traduci pagina" class="translate-select" id="customTranslate">
                    <option value="it">Italiano</option>
                    <option value="en">English</option>
                    <option value="fr">Français</option>
                    <option value="de">Deutsch</option>
                    <option value="es">Español</option>
                    <option value="pl">Polski</option>
                    <option value="pt">Português</option>
                    <option value="ru">Русский</option>
                    <option value="ja">日本語</option>
                    <option value="zh-CN">中文 (简体)</option>
                    <option value="ar">العربية</option>
                </select>
                <div aria-hidden="true" id="google_translate_element" style="position:absolute;left:-9999px;top:-9999px;height:0;width:0;overflow:hidden"></div>
            </div>
            
            <!-- BOX CERCA (UI tua, non Google) -->
            <div class="search-container" role="search">
                <input aria-label="Cerca" id="site-search" placeholder="Cerca nel sito..." type="search"/>
                <i aria-hidden="true" class="fa-solid fa-magnifying-glass search-icon"></i>
            </div>
            
            <!-- Pulsanti -->
            <button class="ctrl-btn" id="btn-thunder" title="Riproduci tuono">⚡ Tuono</button>
            <button class="ctrl-btn" id="btn-explode" title="Esplodi testo">💥 Esplodi</button>
        </div>
    </div>
    
    <!-- Header & Mega Menu -->
    <header>
        <div class="menu-container">
            <nav class="menu-desktop">
                <ul role="menu">
                    <li class="dropdown">
                        <a class="menu-btn underline-effect" href="https://casi0048.github.io/pagine/benvenuti.html" role="menuitem"> 🗝️ INCIPIT</a>
                    </li>
                    <li class="dropdown">
                        <button aria-expanded="false" aria-haspopup="true" class="menu-btn underline-effect" role="menuitem">
                            🏛️Filosofia antica <span class="arrow">▼</span>
                        </button>
                        <div aria-label="Sottomenu Filosofia antica" class="mega-menu columns-4" role="menu">
                            <!-- Contenuto del menu preservato -->
                            <div>
                                <h4>Presocratici</h4>
                                <a href="Presocratici/talete.html" role="menuitem">Talete</a>
                                <a href="Presocratici/anassimandro.html" role="menuitem">Anassimandro</a>
                                <a href="Presocratici/anassimene.html" role="menuitem">Anassimene</a>
                                <a href="articoli/eraclito.html" role="menuitem">Eraclito</a>
                            </div>
                            <!-- Altri elementi del menu -->
                        </div>
                    </li>
                    <!-- Altri elementi del menu -->
                </ul>
            </nav>
        </div>
    </header>
    
    <!-- QUOTES BAR sotto la barra del menu -->
    <div aria-live="polite" class="quotes-bar" id="quotesBar">
        <span class="quote-text" id="quotesText"></span>
        <span class="author" id="quotesAuthor"></span>
    </div>
    
    <!-- ===== SLIDER VERTICALE SINISTRA ===== -->
    <div class="slider-vertical">
        <div class="slider-inner">
            <!-- Slides preservate -->
            <div class="slide-vertical">
                <img alt="Socrate" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/immagini%20per%20sito/Socrates_Louvre.jpg" loading="eager" decoding="async" width="260" height="340"/>
                <p>Socrate</p>
            </div>
            <!-- Altre slides -->
        </div>
    </div>
    
    <!-- ===== CONTROLLI SLIDER VERTICALE ===== -->
    <div class="slider-controls" id="slider-controls">
        <button class="ctrl-btn" id="slider-toggle" title="Avvia/Ferma scorrimento">⏯️ Avvia / Ferma</button>
        <button class="ctrl-btn" id="slider-invert" title="Inverti direzione">🔄 Inverti</button>
        <label class="speed-label" for="slider-speed">
            <input id="slider-speed" max="20" min="1" type="range" value="8"/>
        </label>
    </div>
    
    <!-- ===== BLOB ANIMATO DESTRA (Ultimi articoli) ===== -->
    <aside aria-label="Ultimi articoli" class="articles-blob">
        <h3>📰 Ultimi articoli</h3>
        <ul>
            <li><a href="articoli/ipazia.html">Ipazia di Alessandria</a></li>
            <li><a href="articoli/2nietzsche.html">Nietzsche filosofo folgorante</a></li>
            <li><a href="articoli/hegel.html">Hegel</a></li>
            <li><a href="articoli/heidegger.html">Martin Heidegger</a></li>
            <li><a href="articoli/schelling.html">Friedrich Schelling:</a></li>
        </ul>
    </aside>
    
    <!-- Main -->
    <main>
        <!-- ===Inizio Exploding text (HTML) === -->
        <section class="welcome-section">
            <h1 class="welcome-title" id="title">Benvenuto<br/>in Echi di Sofia</h1>
            <p class="welcome-subtitle" id="subtitle">Un viaggio tra stelle e pensiero</p>
            <div class="typing-wrap">
                <div class="typing-effect"></div>
                <span aria-hidden="true" class="caret"></span>
            </div>
            <!-- Testo esplosivo con ritorno -->
            <div class="exploding-text" id="exploding" title="Clicca per esplodere">
                ⏳  Pensare, dunque è ancora possibile 🧘
            </div>
        </section>
    </main>
    
    <!-- Particelle layer -->
    <div aria-hidden="true" id="philoParticles"></div>
    
    <!-- Footer -->
    <footer>
        <div class="footer-wrap">
            <div class="footer-columns">
                <div class="col about">
                    <h3>Echi di Sofia</h3>
                    <p>Tra pensiero e stelle: un percorso tra scuole, autori e temi della filosofia, dalla classicità al contemporaneo.</p>
                </div>
                <!-- Sezioni (indicizzate per la ricerca) -->
                <div class="search-sections">
                    <h4>Sezioni</h4>
                    <ul>
                        <li><a data-search="include" data-title="Incipit" href="pagine/benvenuti.html">Incipit</a></li>
                        <li><a data-search="include" data-title="Cinismo" href="articoli/cinismo.html">Cinismo</a></li>
                        <li><a data-search="include" data-title="Epicureismo" href="articoli/epicureismo.html">Epicureismo</a></li>
                        <li><a data-search="include" data-title="Filosofia indiana" href="articoli/filosofia-indiana.html">Filosofia indiana</a></li>
                        <li><a data-search="include" data-title="Platonismo" href="articoli/platonismo.html">Platonismo</a></li>
                        <li><a data-search="include" data-title="Scetticismo" href="articoli/scetticismo.html">Scetticismo</a></li>
                        <li><a data-search="include" data-title="Stoicismo" href="articoli/stoicismo.html">Stoicismo</a></li>
                    </ul>
                </div>
                <div class="col contact">
                    <h4>Contatti</h4>
                    <ul>
                        <li><a href="mailto:info@echidisofia.example">info@echidisofia.example</a></li>
                        <li><a href="contatti.html">Modulo contatti</a></li>
                    </ul>
                    <div class="social">
                        <a aria-label="Instagram" href="#"><i class="fa-brands fa-instagram"></i></a>
                        <a aria-label="YouTube" href="#"><i class="fa-brands fa-youtube"></i></a>
                        <a aria-label="X/Twitter" href="#"><i class="fa-brands fa-x-twitter"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-legal">
                <span>© <span id="year"></span> Echi di Sofia</span>
                <span class="dot">•</span>
                <a href="https://casi0048.github.io/pagine/privacy-policy.html">Privacy</a>
                <span class="dot">•</span>
                <a href="https://casi0048.github.io/pagine/credits.html">Crediti</a>
                <span class="dot">•</span>
            </div>
        </div>
    </footer>

    <!-- INIZIO Box Bertrand Russell -->
    <div id="russell-box">
        <button id="russell-btn" title="Clicca per ascoltare la citazione">
            🎵 "Se un filosofo è un uomo cieco, in una stanza buia, che cerca un gatto nero che non c'è, un teologo è l'uomo che riesce a trovare quel gatto."<br/><strong>– Bertrand Russell</strong>
        </button>
    </div>
    <div id="russell-hint">Clicca per ascoltare la chitarra 🎸</div>
    <audio id="russell-audio" preload="auto" src="https://casi0048.github.io/suoni/gitarra.mp3"></audio>

    <!-- 🎬 INIZIO PLAYER (destro) -->
    <div class="video-container" id="video-right">
        <!-- DIZIONARIO FILOSOFICO -->
        <details class="edx-dict" id="edx-dict">
            <summary class="edx-dict__head">
                <span class="edx-dict__title">Dizionario filosofico</span>
                <span class="edx-dict__chev">▾</span>
            </summary>
            <div class="edx-dict__body">
                <form class="edx-dict__controls" id="edx-dict-form" onsubmit="return false;">
                    <select class="edx-dict__select" id="edx-source" title="Fonte">
                        <option selected value="sep">SEP (Stanford)</option>
                        <option value="iep">IEP</option>
                        <option value="treccani">Treccani</option>
                        <option value="philosophica">Philosophica</option>
                        <option value="wiki-it">Wikipedia (IT)</option>
                    </select>
                    <input class="edx-dict__input" id="edx-q" name="query" placeholder="Cerca concetti, autori, scuole…" type="search"/>
                    <button class="edx-dict__btn" id="edx-go" type="button">Cerca</button>
                </form>
            </div>
        </details>
        <iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen frameborder="0" height="264" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/G_REgkOuQfw" title="Schopenhauer e Nietzsche (Hans-Georg Gadamer) - 3x4" width="280"></iframe>
    </div>

    <!-- INIZIO MINI PLAYER (sinistra) -->
    <div class="audio-title">🎹 Musica classica 🎺</div>
    <div class="audio-player" id="audio-player">
        <audio id="myAudio" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/suoni/Strauss.mp3"></audio>
        <div class="controls">
            <button id="playPause" title="Riproduci/Pausa">▶️</button>
            <span id="time">0:00 / 0:00</span>
            <input id="volume" max="1" min="0" step="0.01" title="Volume" type="range">
        </div>
    </div>

    <!-- Audio effetti -->
    <audio id="thunder-sound" preload="auto" src="https://casi0048.github.io/suoni/thunder-sound.mp3"></audio>
    <audio id="explosionSound" preload="auto" src="https://raw.githubusercontent.com/Casi0048/casi0048.github.io/main/suoni/explosion-1.mp3"></audio>

    <!-- COOKIE BANNER -->
    <div aria-label="Consenso cookie" class="cookie-banner" hidden id="cookie-banner" role="region">
        <div class="cookie-text">
            <strong>Cookie.</strong> Usiamo cookie tecnici e, con il tuo consenso, analitici e di profilazione per migliorare l'esperienza.
            <a href="https://casi0048.github.io/pagine/privacy-policy.html" rel="noopener" target="_blank">Scopri di più</a>.
        </div>
        <div class="cookie-actions">
            <button class="btn ghost" id="cookie-decline">Rifiuta</button>
            <button class="btn outline" id="cookie-customize">Personalizza</button>
            <button class="btn solid" id="cookie-accept">Accetta</button>
        </div>
    </div>

    <!-- MODAL PREFERENZE -->
    <div aria-hidden="true" aria-labelledby="cookie-modal-title" aria-modal="true" class="cookie-modal" id="cookie-modal" role="dialog">
        <div class="cookie-modal__panel">
            <button aria-label="Chiudi" class="cookie-close" id="cookie-close">×</button>
            <h3 id="cookie-modal-title">Preferenze cookie</h3>
            <p class="muted">Puoi modificare le tue scelte in qualsiasi momento.</p>
            <ul class="cookie-list">
                <li>
                    <label><input checked disabled type="checkbox"> Essenziali (sempre attivi)</label>
                </li>
                <li>
                    <label><input id="consent-analytics" type="checkbox"/> Analitici</label>
                    <small>Ci aiutano a capire come usi il sito.</small>
                </li>
                <li>
                    <label><input id="consent-preferences" type="checkbox"/> Preferenze</label>
                    <small>Ricordano impostazioni e scelte.</small>
                </li>
                <li>
                    <label><input id="consent-marketing" type="checkbox"/> Marketing</label>
                    <small>Contenuti e misurazioni personalizzate.</small>
                </li>
            </ul>
            <div class="cookie-modal__actions">
                <button class="btn outline" id="cookie-cancel">Annulla</button>
                <button class="btn solid" id="cookie-save">Salva preferenze</button>
            </div>
        </div>
    </div>

    <!-- Pulsante per riaprire -->
    <button class="ctrl-btn btn-link" id="manage-cookies" title="Gestisci consenso cookie" type="button">
        Gestione cookie
    </button>

    <!-- INIZIO COSMO DINAMICO -->
    <div class="galaxy"></div>
    <div class="stardust" id="stardust"></div>
    <div class="stars" id="stars"></div>
    <div class="meteor-shower" id="meteorShower"></div>
    <div class="planet" style="width: 100px; height: 100px; background: radial-gradient(circle at 30% 30%, #FF6347, #8B0000); top: 20%; left: 15%;">
        <div class="planet-ring" style="width: 180px; height: 180px; top: -40px; left: -40px; animation-duration: 50s;"></div>
    </div>
    <div class="planet" style="width: 60px; height: 60px; background: radial-gradient(circle at 30% 30%, #40E0D0, #008B8B); bottom: 25%; right: 20%;">
        <div class="planet-ring" style="width: 120px; height: 120px; top: -30px; left: -30px; animation-duration: 30s;"></div>
    </div>
    <!-- FINE COSMO DINAMICO -->

    <!--  inizio script stelle cadenti  da dx a sx-->
    <canvas id="shooting-stars"></canvas>
    <!--  fine script stelle cadenti-->

    <script>
        // ===== INIZIALIZZAZIONE =====
        document.addEventListener('DOMContentLoaded', function() {
            // Inizializza l'anno nel footer
            document.getElementById('year').textContent = new Date().getFullYear();
            
            // Inizializza le citazioni
            initQuotes();
            
            // Inizializza l'effetto di scrittura
            initTypingEffect();
            
            // Inizializza lo slider
            initSlider();
            
            // Inizializza l'effetto esplosione
            initExplosionEffect();
            
            // Inizializza l'effetto tuono
            initThunderEffect();
            
            // Inizializza le particelle
            initParticles();
            
            // Inizializza il box di Russell
            initRussellBox();
            
            // Inizializza il player audio
            initAudioPlayer();
            
            // Inizializza il dizionario filosofico
            initPhilosophicalDictionary();
            
            // Inizializza il banner cookie
            initCookieBanner();
            
            // Inizializza il traduttore
            initGoogleTranslate();
        });

        // ===== FUNZIONI DI INIZIALIZZAZIONE =====
        
        function initQuotes() {
            const QUOTES = [
                { text: "Conosci te stesso e conoscerai l'universo e gli dei.", author: "Socrate" },
                { text: "Il sapere è l'unico bene che aumenta condividendolo.", author: "Pitagora" },
                { text: "La meraviglia è il principio di ogni conoscenza.", author: "Aristotele" },
                { text: "Non è forte colui che non cade mai, ma colui che cadendo si rialza.", author: "Confucio" },
                { text: "Penso, dunque sono.", author: "Cartesio" },
                { text: "L'uomo è condannato ad essere libero.", author: "Jean-Paul Sartre" },
                { text: "La vita senza esame non è degna di essere vissuta.", author: "Socrate" },
                { text: "Il dubbio è il principio della saggezza.", author: "René Descartes" },
                { text: "La felicità è reale solo se condivisa.", author: "Christopher McCandless" },
                { text: "L'essenza della filosofia è la ricerca incessante.", author: "Immanuel Kant" }
            ];
            
            const tEl = document.getElementById('quotesText');
            const aEl = document.getElementById('quotesAuthor');
            let i = 0;
            
            function next(){
                const q = QUOTES[i]; i = (i+1) % QUOTES.length;
                tEl.style.opacity = '0'; aEl.style.opacity = '0';
                setTimeout(() => {
                    tEl.textContent = q.text; aEl.textContent = '— ' + q.author;
                    tEl.style.opacity = '1'; aEl.style.opacity = '1';
                }, 200);
            }
            
            next(); 
            setInterval(next, 5000);
        }

        function initTypingEffect() {
            const el = document.querySelector(".typing-effect");
            const texts = [
                "Φιλοσοφία: l'arte di cercare appigli nel vuoto.",
                "Pensare è camminare senza mappa.",
                "La verità è un equilibrio mobile.",
                "La domanda giusta vale più di mille risposte.",
                "L'inquietudine è il motore della ricerca."
            ];
            
            let textIndex = 0, index = 0, forward = true, delay = 0, stepCounter = 0;
            const writeSpeed = 3, deleteSpeed = 2;
            
            function animate() {
                stepCounter++;
                const speed = forward ? writeSpeed : deleteSpeed;
                if (stepCounter >= speed) {
                    stepCounter = 0;
                    if (delay > 0) { delay--; }
                    else {
                        const currentText = texts[textIndex];
                        if (forward) {
                            index++;
                            if (index > currentText.length) { forward = false; delay = 60; }
                        } else {
                            index--;
                            if (index < 0) { forward = true; textIndex = (textIndex + 1) % texts.length; delay = 20; }
                        }
                        el.textContent = currentText.substring(0, Math.max(0,index));
                    }
                }
                requestAnimationFrame(animate);
            }
            animate();
        }

        function initSlider() {
            const wrap = document.querySelector('.slider-vertical');
            if(!wrap) return;
            
            const inner = wrap.querySelector('.slider-inner');
            // Duplica contenuto per loop infinito
            inner.innerHTML = inner.innerHTML + inner.innerHTML;
            
            let y = 0, paused = false;
            const speed = 0.35; // px/frame
            
            wrap.addEventListener('mouseenter', () => paused = true);
            wrap.addEventListener('mouseleave', () => paused = false);
            
            function step(){
                if(!paused){
                    y += speed;
                    if(y >= inner.scrollHeight/2) y = 0;
                    inner.style.transform = `translateY(-${y}px)`;
                }
                requestAnimationFrame(step);
            }
            step();
        }

        function initExplosionEffect() {
            const exploding = document.getElementById("exploding");
            if (!exploding) return;

            // prepara lo split in span una sola volta
            if (!exploding.__prepared){
                const text = exploding.textContent;
                exploding.textContent = "";
                const frag = document.createDocumentFragment();
                for (const ch of text){
                    const span = document.createElement("span");
                    span.className = "ch";
                    span.textContent = ch;
                    frag.appendChild(span);
                }
                exploding.appendChild(frag);
                exploding.__prepared = true;
            }

            const letters = Array.from(exploding.querySelectorAll("span"));

            function explodeAndReturn(){
                // evita re-entrance mentre l'animazione è in corso
                if (explodeAndReturn.__busy) return;
                explodeAndReturn.__busy = true;

                if (typeof gsap !== 'undefined') {
                    gsap.to(letters, {
                        duration: 0.8,
                        x: () => (Math.random() - 0.5) * 400,
                        y: () => (Math.random() - 0.5) * 300,
                        rotation: () => (Math.random() - 0.5) * 720,
                        opacity: 0,
                        ease: "power3.out",
                        stagger: 0.02,
                        onComplete: () => {
                            gsap.to(letters, {
                                duration: 1.2,
                                x: 0,
                                y: 0,
                                rotation: 0,
                                opacity: 1,
                                ease: "elastic.out(1, 0.5)",
                                stagger: 0.02,
                                onComplete: () => { explodeAndReturn.__busy = false; }
                            });
                        }
                    });
                }
            }

            // 1) Esplosione automatica al caricamento (una volta)
            setTimeout(explodeAndReturn, 1000);

            // 2) Esplosioni successive al click
            exploding.addEventListener("click", explodeAndReturn);
            
            // 3) Esplosione dal pulsante
            document.getElementById('btn-explode')?.addEventListener('click', explodeAndReturn);
        }

        function initThunderEffect() {
            const overlay = document.getElementById('lightning');
            const bolt = document.getElementById('bolt');
            const audio = document.getElementById('thunder-sound');
            const btn = document.getElementById('btn-thunder');

            if (!overlay || !bolt || !audio || !btn) return;

            // Stato tuono
            let thunderOn = false;

            function playThunder(){
                if (!thunderOn || !audio) return;
                try { 
                    audio.currentTime = 0; 
                    audio.play().catch(() => {}); 
                } catch(e){}
            }

            function flash(){
                // posizione/parametri casuali
                const xPerc = 15 + Math.random()*70;
                const yPerc = 10 + Math.random()*65;
                const angle = -25 + Math.random()*50;
                const scaleY = 0.8 + Math.random()*1.2;

                // overlay
                overlay.style.transition = 'none'; 
                overlay.offsetHeight;
                overlay.style.background = `radial-gradient(circle at ${xPerc}% ${yPerc}%, rgba(255,255,255,.95), rgba(255,255,255,.22) 40%, transparent 65%)`;
                overlay.style.opacity = '1';
                overlay.style.transition = 'opacity 80ms ease-out';
                setTimeout(() => overlay.style.opacity = '0', 140);

                // saetta
                bolt.style.left = xPerc + '%';
                bolt.style.top = yPerc + '%';
                bolt.style.transform = `translate(-50%,-50%) rotate(${angle}deg) scaleY(${scaleY})`;
                bolt.style.transition = 'transform 90ms ease-out, opacity 280ms ease-out';
                bolt.style.opacity = '1';
                setTimeout(() => bolt.style.opacity = '0', 180);

                // audio (solo se ON)
                setTimeout(playThunder, 120);
            }

            // --- loop VISIVO sempre attivo ---
            const MIN = 30000, MAX = 40000; // 30–40s
            let flashTimer = null;
            
            function schedule(){
                const delay = MIN + Math.random()*(MAX-MIN);
                flashTimer = setTimeout(() => { flash(); schedule(); }, delay);
            }
            schedule();

            // --- API per il bottone: solo audio ---
            function updateBtn(){
                btn.classList.toggle('active', thunderOn);
                btn.setAttribute('aria-pressed', thunderOn ? 'true' : 'false');
                btn.textContent = thunderOn ? '⚡ Tuono: ON' : '⚡ Tuono';
            }

            btn.addEventListener('click', function(e){
                e.preventDefault();
                thunderOn = !thunderOn;
                updateBtn();
                if (thunderOn) { 
                    playThunder(); 
                } else { 
                    try { audio.pause(); audio.currentTime = 0; } catch(_){} 
                }
            });

            updateBtn();
        }

        function initParticles() {
            const container = document.getElementById('philoParticles');
            if (!container) return;

            const symbols = [
                '∞','Φ','Ψ','Λ','Δ','Ω','π','∑','∏','√',
                '≡','≈','∴','∀','∃','∈','∧','∨','⊕','⊗',
                'Σ','Θ','Ξ','ℵ','∂','∇','∫',
                'Sapienza','Verità','Logos','Thanatos','Mito','Essere','Divenire',
                'Idee','Archè','Armonia','Principio','Destino','Libertà','Giustizia',
                'Virtù','Pensiero','Domanda','Risposta','Silenzio','Samsara','Nirvana',
                'Epicuro','Parmenide','Dialogo','Socratico','Platone','Sostanza',
                'Aristotele','Stoà','Eraclito','Nous','Anima','Cosmo',
                'Ipazia','😸Livia','Maria Teresa','Gesù Nazareno','Demetrio Falereo','😺 Polpetta','Casimiro','Guido','Francesco',
                '✨','⚖️','🌎','🛸 ','📚','🪐','🌌','💭','🧠','🗣️','📝','💡','👨‍🚀','🌓','🌕',
                '🌠','☄️','🪐','🌙','🌍 ','🌞','🚀','📗','📙','📕','🔬','☀️',
                '🧭','⌛','🌗','🛸','🌏 ','🌖','🌔','💫 ','🕳️','♾️'
            ];

            // Crea le particelle
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.textContent = symbols[Math.floor(Math.random() * symbols.length)];
                particle.style.fontSize = `${Math.random() * 20 + 14}px`;
                particle.style.color = `hsl(${Math.random() * 60 + 30}, 100%, 70%)`;
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100}%`;
                particle.style.opacity = Math.random() * 0.5 + 0.3;
                
                container.appendChild(particle);
                
                // Animazione con GSAP se disponibile
                if (typeof gsap !== 'undefined') {
                    gsap.to(particle, {
                        x: `+=${Math.random() * 100 - 50}`,
                        y: `+=${Math.random() * 100 - 50}`,
                        rotation: Math.random() * 360,
                        duration: Math.random() * 10 + 10,
                        repeat: -1,
                        yoyo: true,
                        ease: "sine.inOut"
                    });
                }
            }
        }

        function initRussellBox() {
            const btn = document.getElementById("russell-btn");
            const audio = document.getElementById("russell-audio");
            
            if (!btn || !audio) return;
            
            btn.addEventListener("click", function() {
                try {
                    audio.currentTime = 0;
                    audio.play();
                } catch (err) {}
            });
            
            // Animazione con GSAP se disponibile
            if (typeof gsap !== 'undefined') {
                gsap.from("#russell-box", { x: -150, opacity: 0, duration: 1.2, ease: "power3.out" });
                gsap.from("#russell-hint", { x: -150, opacity: 0, duration: 1.2, delay: 0.35, ease: "power3.out" });
                gsap.to("#russell-btn", { scale: 1.05, duration: 2, repeat: -1, yoyo: true, ease: "power1.inOut" });
            }
        }

        function initAudioPlayer() {
            const box = document.getElementById('audio-player');
            const audio = document.getElementById('myAudio');
            const btn = document.getElementById('playPause');
            const time = document.getElementById('time');
            const vol = document.getElementById('volume');
            
            if (!box || !audio || !btn || !time || !vol) return;

            function fmt(s){
                if (!isFinite(s)) return '0:00';
                const m = Math.floor(s/60);
                const sec = Math.floor(s%60);
                return m + ':' + (sec<10 ? '0'+sec : sec);
            }
            
            function updateTime(){
                time.textContent = `${fmt(audio.currentTime)} / ${fmt(audio.duration)}`;
            }
            
            // Volume di partenza
            vol.value = 0.8;
            audio.volume = parseFloat(vol.value);

            // Eventi
            btn.addEventListener('click', () => {
                if (audio.paused){
                    audio.play().catch(() => {});
                    btn.textContent = '⏸️';
                } else {
                    audio.pause();
                    btn.textContent = '▶️';
                }
            });
            
            vol.addEventListener('input', () => audio.volume = parseFloat(vol.value));
            audio.addEventListener('timeupdate', updateTime);
            audio.addEventListener('loadedmetadata', updateTime);
            audio.addEventListener('ended', () => { btn.textContent = '▶️'; });

            // Animazione con GSAP se disponibile
            if (typeof gsap !== 'undefined') {
                gsap.to(box, { opacity: 1, y: 0, duration: 0.6, ease: 'power2.out', delay: 0.4 });
            } else {
                box.style.opacity = '1';
                box.style.transform = 'none';
            }
        }

        function initPhilosophicalDictionary() {
            const form = document.getElementById('edx-dict-form');
            const sel = document.getElementById('edx-source');
            const input = document.getElementById('edx-q');
            const btn = document.getElementById('edx-go');
            
            if(!form || !sel || !input || !btn) return;

            const build = {
                sep: q => 'https://plato.stanford.edu/search/searcher.py?query=' + encodeURIComponent(q),
                iep: q => 'https://iep.utm.edu/?s=' + encodeURIComponent(q),
                treccani: q => 'https://www.treccani.it/enciclopedia/ricerca/' + encodeURIComponent(q) + '/',
                philosophica: q => 'https://www.philosophica.info/?s=' + encodeURIComponent(q),
                'wiki-it': q => 'https://it.wikipedia.org/w/index.php?search=' + encodeURIComponent(q)
            };

            function go(){
                const q = (input.value || '').trim(); 
                if(!q) return;
                const src = sel.value || 'sep';
                const url = (build[src] || build.sep)(q);
                window.open(url, '_blank', 'noopener');
            }

            btn.addEventListener('click', go);
            input.addEventListener('keydown', e => {
                if(e.key === 'Enter'){ e.preventDefault(); e.stopPropagation(); go(); }
            });
        }

        function initCookieBanner() {
            const banner = document.getElementById('cookie-banner');
            const acceptBtn = document.getElementById('cookie-accept');
            const declineBtn = document.getElementById('cookie-decline');
            const customizeBtn = document.getElementById('cookie-customize');
            const modal = document.getElementById('cookie-modal');
            const closeBtn = document.getElementById('cookie-close');
            const saveBtn = document.getElementById('cookie-save');
            const cancelBtn = document.getElementById('cookie-cancel');
            const manageBtn = document.getElementById('manage-cookies');
            
            if (!banner) return;

            // Controlla se l'utente ha già fatto una scelta
            const cookieChoice = localStorage.getItem('cookieChoice');
            if (cookieChoice) {
                banner.hidden = true;
            }

            // Gestione pulsanti del banner
            acceptBtn?.addEventListener('click', function() {
                localStorage.setItem('cookieChoice', 'accepted');
                banner.hidden = true;
            });

            declineBtn?.addEventListener('click', function() {
                localStorage.setItem('cookieChoice', 'rejected');
                banner.hidden = true;
            });

            customizeBtn?.addEventListener('click', function() {
                modal?.setAttribute('aria-hidden', 'false');
            });

            closeBtn?.addEventListener('click', function() {
                modal?.setAttribute('aria-hidden', 'true');
            });

            saveBtn?.addEventListener('click', function() {
                // Qui si potrebbero salvare le preferenze specifiche
                localStorage.setItem('cookieChoice', 'custom');
                modal?.setAttribute('aria-hidden', 'true');
                banner.hidden = true;
            });

            cancelBtn?.addEventListener('click', function() {
                modal?.setAttribute('aria-hidden', 'true');
            });

            manageBtn?.addEventListener('click', function() {
                banner.hidden = false;
            });
        }

        function initGoogleTranslate() {
            function googleTranslateElementInit() {
                if (typeof google !== 'undefined' && google.translate) {
                    new google.translate.TranslateElement({
                        pageLanguage: 'it',
                        includedLanguages: 'en,fr,de,es,pl,pt,ru,ja,zh-CN,ar',
                        layout: google.translate.TranslateElement.InlineLayout.SIMPLE
                    }, 'google_translate_element');
                }
            }

            function setCookie(name, value){
                document.cookie = name + "=" + value + "; expires=" + new Date(Date.now()+365*24*60*60*1000).toUTCString() + "; path=/";
            }

            function getCookie(name){
                return (document.cookie.match('(^|;)\\s*'+name+'\\s*=\\s*([^;]+)')||[])[2] || "";
            }

            function applyLang(lang){
                const val = (lang && lang !== 'it') ? ("/it/"+lang) : "/it/it";
                setCookie("googtrans", val);
                const internal = document.querySelector(".goog-te-combo");
                if (internal) { 
                    internal.value = lang; 
                    internal.dispatchEvent(new Event('change')); 
                } else { 
                    location.reload(); 
                }
            }

            function syncUI(){
                const sel = document.getElementById('customTranslate');
                if (!sel) return;
                const c = getCookie("googtrans");
                const current = (c.split("/")[2] || "it");
                for (let i = 0; i < sel.options.length; i++) { 
                    if (sel.options[i].value === current) { 
                        sel.selectedIndex = i; 
                        break; 
                    } 
                }
            }

            document.addEventListener('change', function(e){
                if (e.target && e.target.id === 'customTranslate') {
                    applyLang(e.target.value);
                }
            });

            window.addEventListener('pageshow', syncUI);
            document.addEventListener('visibilitychange', function() { 
                if (!document.hidden) syncUI(); 
            });
            
            syncUI();

            // Carica lo script di traduzione
            const script = document.createElement('script');
            script.src = '//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit';
            script.async = true;
            document.head.appendChild(script);
        }

        // INIZIO COSMO DINAMICO JS
        const starsContainer = document.getElementById('stars');
        if (starsContainer) {
            for (let i = 0; i < 400; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                
                star.style.setProperty('--duration', `${Math.random() * 5 + 3}s`);
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.width = `${Math.random() * 2 + 1}px`;
                star.style.height = star.style.width;
                
                // 15% stelle colorate
                if (Math.random() < 0.15) {
                    const colors = ['#FF1493', '#00BFFF', '#FFD700', '#7CFC00'];
                    star.style.background = colors[Math.floor(Math.random() * colors.length)];
                    star.style.boxShadow = `0 0 5px 1px ${star.style.background}`;
                }
                
                starsContainer.appendChild(star);
            }
        }

        // Supernove casuali
        function createSupernova() {
            const supernova = document.createElement('div');
            supernova.className = 'supernova';
            
            const size = Math.random() * 100 + 50;
            const colors = [
                'radial-gradient(circle, rgba(255,69,0,0.8) 0%, rgba(255,215,0,0.6) 50%, transparent 70%)',
                'radial-gradient(circle, rgba(138,43,226,0.8) 0%, rgba(75,0,130,0.6) 50%, transparent 70%)',
                'radial-gradient(circle, rgba(0,191,255,0.8) 0%, rgba(30,144,255,0.6) 50%, transparent 70%)'
            ];
            
            supernova.style.background = colors[Math.floor(Math.random() * colors.length)];
            supernova.style.width = `${size}px`;
            supernova.style.height = `${size}px`;
            supernova.style.left = `${Math.random() * 90 + 5}%`;
            supernova.style.top = `${Math.random() * 90 + 5}%`;
            
            document.body.appendChild(supernova);
            
            setTimeout(() => {
                supernova.remove();
            }, 4000);
        }
        
        setInterval(createSupernova, 3000);

        // Sciame meteorico
        const meteorShower = document.getElementById('meteorShower');
        if (meteorShower) {
            function createMeteorShower() {
                for (let i = 0; i < 15; i++) {
                    setTimeout(() => {
                        const meteor = document.createElement('div');
                        meteor.className = 'meteor';
                        
                        const startX = Math.random() * 100 + 50;
                        const startY = -10;
                        const endX = startX - (Math.random() * 100 + 50);
                        const endY = 100 + Math.random() * 20;
                        const duration = Math.random() * 2 + 1;
                        
                        meteor.style.setProperty('--start-x', `${startX}%`);
                        meteor.style.setProperty('--start-y', `${startY}%`);
                        meteor.style.setProperty('--end-x', `${endX}%`);
                        meteor.style.setProperty('--end-y', `${endY}%`);
                        meteor.style.animationDuration = `${duration}s`;
                        
                        // Colori casuali per le meteore
                        const colors = ['white', '#FF6347', '#40E0D0', '#9370DB'];
                        meteor.style.background = colors[Math.floor(Math.random() * colors.length)];
                        
                        meteorShower.appendChild(meteor);
                        
                        setTimeout(() => {
                            meteor.remove();
                        }, duration * 1000);
                    }, i * 200);
                }
            }
            
            setInterval(createMeteorShower, 5000);
            createMeteorShower();
        }

        // Particelle di polvere stellare
        const stardustContainer = document.getElementById('stardust');
        if (stardustContainer) {
            for (let i = 0; i < 100; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100 + 100}%`;
                particle.style.animationDuration = `${Math.random() * 30 + 20}s`;
                particle.style.animationDelay = `${Math.random() * 10}s`;
                
                // Dimensione casuale
                const size = Math.random() * 2 + 0.5;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                stardustContainer.appendChild(particle);
            }
        }

        // Effetto di parallasse al movimento del mouse
        document.addEventListener('mousemove', (e) => {
            const x = e.clientX / window.innerWidth;
            const y = e.clientY / window.innerHeight;
            
            const galaxy = document.querySelector('.galaxy');
            if (galaxy) {
                galaxy.style.transform = `
                    translate(-50%, -50%) 
                    rotate(${x * 10 - 5}deg)
                    scale(${1 + y * 0.05})
                `;
            }
            
            document.querySelectorAll('.planet').forEach((planet, i) => {
                const factor = i === 0 ? 0.03 : 0.02;
                planet.style.transform = `translate(${(x - 0.5) * 20}px, ${(y - 0.5) * 20}px)`;
            });
        });

        //  inizio script stelle cadenti da dx a sx
        const canvas = document.getElementById("shooting-stars");
        if (canvas) {
            const ctx = canvas.getContext("2d");
            let w, h;
            
            function resizeCanvas() {
                w = canvas.width = window.innerWidth;
                h = canvas.height = window.innerHeight;
            }
            
            window.addEventListener("resize", resizeCanvas);
            resizeCanvas();
            
            class ShootingStar {
                constructor() {
                    this.reset();
                }
                
                reset() {
                    this.x = Math.random() * w;
                    this.y = Math.random() * h * 0.5;
                    this.len = Math.random() * 80 + 10;
                    this.speed = Math.random() * 4 + 2;
                    this.size = Math.random() * 2 + 1;
                    this.opacity = Math.random() * 0.5 + 0.5;
                }
                
                update() {
                    this.x -= this.speed;
                    this.y += this.speed * 0.5;
                    
                    if (this.x < -this.len || this.y > h + this.len) {
                        this.reset();
                        this.x = Math.random() * w + w;
                        this.y = Math.random() * h * 0.7;
                    }
                }
                
                draw() {
                    ctx.beginPath();
                    const grad = ctx.createLinearGradient(this.x, this.y, this.x + this.len, this.y - this.len);
                    grad.addColorStop(0, `rgba(255,255,255,${this.opacity})`);
                    grad.addColorStop(1, "rgba(255,255,255,0)");
                    ctx.strokeStyle = grad;
                    ctx.lineWidth = this.size;
                    ctx.moveTo(this.x, this.y);
                    ctx.lineTo(this.x + this.len, this.y - this.len);
                    ctx.stroke();
                }
            }
            
            let stars = [];
            for (let i = 0; i < 20; i++) {
                stars.push(new ShootingStar());
            }
            
            function animate() {
                ctx.clearRect(0, 0, w, h);
                stars.forEach(star => {
                    star.update();
                    star.draw();
                });
                requestAnimationFrame(animate);
            }
            animate();
        }
        //  fine script stelle cadenti
    </script>

<script id="translate-and-explode-wiring">
document.addEventListener("DOMContentLoaded", function(){
  // === Traduttore: usa il <select id="customTranslate"> già presente ===
  const translateSelect = document.getElementById("customTranslate");
  if (translateSelect) {
    translateSelect.addEventListener("change", function(){
      const tl = this.value;
      if (!tl || tl === "it") return; // niente per Italiano
      const u = location.href;
      const url = "https://translate.google.com/translate?sl=it&tl=" + encodeURIComponent(tl) + "&u=" + encodeURIComponent(u);
      window.open(url, "_blank", "noopener");
      // torna su IT nell'interfaccia per non confondere
      try { this.value = "it"; } catch(_) {}
    });
  }

  // === Esplodi: aggiungi suono all'effetto esistente ===
  const btnExplode = document.getElementById("btn-explode");
  const boomEl = document.getElementById("explosionSound");
  if (btnExplode && boomEl) {
    btnExplode.addEventListener("click", function(){
      try { boomEl.currentTime = 0; boomEl.play().catch(()=>{}); } catch(e) {}
    });
  }
});
</script>

</body>
</html>
