/* =========================================================
   Echi di Sofia — Accent Layer PLUS
   Estende 'accent-layer.css' per:
   - Mega menu
   - Slider verticale (filosofi)
   - Banner cookie
   - Player audio
   - Dizionario / Enciclopedia
   - Russell Box (callout)
   Suggerito: includere DOPO accent-layer.css
   ========================================================= */

/* ---------- MEGA MENU ---------- */
.mega-menu{
  --mm-border: color-mix(in oklab, var(--accent) 25%, var(--menu-border) 75%);
  --mm-shadow: 0 20px 40px color-mix(in oklab, var(--accent) 10%, #000 90%);
  border-top: 1px solid var(--mm-border);
}
.mega-menu .trigger:hover,
.mega-menu .trigger[aria-expanded="true"]{
  color: var(--accent);
  text-decoration: none;
}
.mega-menu .panel{
  border: 1px solid var(--mm-border);
  box-shadow: var(--mm-shadow);
}
.mega-menu .col-title{
  color: var(--accent);
  text-shadow: 0 0 12px color-mix(in oklab, var(--accent) 25%, transparent);
}
.mega-menu a.item{
  border-radius: 10px;
  transition: background .15s ease, color .15s ease;
}
.mega-menu a.item:hover{
  background: color-mix(in oklab, var(--accent) 14%, transparent);
  color: color-mix(in oklab, var(--accent) 82%, white 18%);
}
.mega-menu .badge, .mega-menu .pill{
  background: color-mix(in oklab, var(--accent) 55%, transparent);
  border-color: color-mix(in oklab, var(--accent) 55%, transparent);
  color: var(--accent-contrast);
}

/* ---------- SLIDER VERTICALE (filosofi) ---------- */
.vertical-slider, .v-slider, .philosopher-slider{
  border: 1px solid color-mix(in oklab, var(--accent) 20%, var(--menu-border) 80%);
  box-shadow: 0 10px 30px color-mix(in oklab, var(--accent) 10%, transparent);
  border-radius: 14px;
}
.slider-controls, .v-slider-controls{
  display: flex; gap: .5rem; align-items: center;
}
.slider-controls .btn, .v-slider-controls .btn,
.slider-controls .btn-ghost, .v-slider-controls .btn-ghost{
  border-color: color-mix(in oklab, var(--accent) 45%, transparent);
}
.slider-controls .btn:hover, .v-slider-controls .btn:hover{
  filter: brightness(1.06);
}
/* velocità (range) segue già il layer base, ma rinforziamo track */
.slider-controls input[type=range], .v-slider-controls input[type=range]{
  accent-color: var(--accent);
}
.slider-caption, .v-slider .caption{
  color: var(--accent-5);
  text-shadow: 0 0 12px color-mix(in oklab, var(--accent) 25%, transparent);
}

/* ---------- BANNER COOKIE ---------- */
.cookie-banner{
  border: 1px solid color-mix(in oklab, var(--accent) 25%, var(--menu-border) 75%);
  box-shadow: 0 12px 30px color-mix(in oklab, var(--accent) 10%, #000 90%);
  border-radius: 14px;
}
.cookie-banner .btn-accept{
  background: linear-gradient(135deg, var(--accent), var(--accent-2));
  color: var(--accent-contrast);
  border-color: color-mix(in oklab, var(--accent) 50%, transparent);
}
.cookie-banner .btn-manage,
.cookie-banner .btn-reject{
  border:1px dashed color-mix(in oklab, var(--accent) 65%, #ffffff22 35%);
  background: color-mix(in oklab, var(--accent) 14%, transparent);
  color: var(--text-light);
}
.cookie-banner .btn-manage:hover,
.cookie-banner .btn-reject:hover{ border-style: solid; filter: var(--accent-glow); }
.cookie-banner .link{ color: color-mix(in oklab, var(--accent) 82%, white 18%); text-decoration-color: var(--accent-3); }

/* ---------- AUDIO PLAYER ---------- */
.audio-player{
  border: 1px solid color-mix(in oklab, var(--accent) 25%, var(--menu-border) 75%);
  background: linear-gradient(180deg, rgba(10,10,26,.85), rgba(10,10,26,.65));
  box-shadow: 0 10px 24px color-mix(in oklab, var(--accent) 12%, transparent);
  color: var(--text-light);
  border-radius: 12px;
}
.audio-title{ color: color-mix(in oklab, var(--accent) 85%, white 15%); }
.audio-player .controls button{
  background: linear-gradient(135deg, var(--accent), var(--accent-2));
  color: var(--accent-contrast);
  border: 1px solid color-mix(in oklab, var(--accent) 45%, transparent);
  border-radius: 10px;
  padding: .3rem .6rem;
}
.audio-player .controls button:hover{ filter: brightness(1.06); }
.audio-player #volume{ width: 120px; }
.audio-player #volume::-webkit-slider-runnable-track{
  height: 4px; border-radius: 999px;
  background: linear-gradient(90deg, var(--accent-3), var(--accent));
}
.audio-player #volume::-webkit-slider-thumb{
  -webkit-appearance: none; appearance: none;
  width: 14px; height: 14px; border-radius: 50%;
  background: var(--accent); border: 2px solid var(--accent-2);
  margin-top: -5px;
}

/* ---------- DIZIONARIO ---------- */
.dictionary, .dictionary-panel, .dictionary-box{
  border: 1px solid color-mix(in oklab, var(--accent) 22%, var(--menu-border) 78%);
  border-radius: 12px;
  box-shadow: 0 10px 24px color-mix(in oklab, var(--accent) 10%, transparent);
}
.dictionary-toggle, .dictionary .toggle{
  border:1px dashed color-mix(in oklab, var(--accent) 60%, #ffffff22 40%);
  background: color-mix(in oklab, var(--accent) 12%, transparent);
  color: var(--text-light);
}
.dictionary a, .dictionary-panel a{ color: color-mix(in oklab, var(--accent) 82%, white 18%); }

/* ---------- ENCICLOPEDIA ---------- */
.encyclopedia-btn{
  background: linear-gradient(135deg, var(--accent), var(--accent-2));
  color: var(--accent-contrast);
  border: 1px solid color-mix(in oklab, var(--accent) 45%, transparent);
  border-radius: 12px; padding: .5rem .8rem;
}
.encyclopedia-btn:hover{ filter: brightness(1.05); }
.encyclopedia-panel{
  border: 1px solid color-mix(in oklab, var(--accent) 22%, var(--menu-border) 78%);
  border-radius: 12px;
  box-shadow: 0 10px 24px color-mix(in oklab, var(--accent) 10%, transparent);
}

/* ---------- RUSSELL BOX (callout) ---------- */
.russell-box{
  position: relative;
  border: 1px solid color-mix(in oklab, var(--accent) 35%, var(--menu-border) 65%);
  border-radius: 16px;
  padding: 16px 18px;
  background: radial-gradient(600px 300px at -10% -10%, color-mix(in oklab, var(--accent) 12%, transparent), transparent 60%);
  box-shadow: 0 12px 34px color-mix(in oklab, var(--accent) 10%, transparent);
}
.russell-box::before{
  content:""; position:absolute; inset: -1px;
  border-radius: 16px;
  pointer-events:none;
  mask: linear-gradient(#000 0 0);
  box-shadow: inset 0 0 40px color-mix(in oklab, var(--accent) 15%, transparent);
}
.russell-box .title{
  display:flex; align-items:center; gap:.5rem;
  color: color-mix(in oklab, var(--accent) 85%, white 15%);
  text-shadow: 0 0 12px color-mix(in oklab, var(--accent) 25%, transparent);
  font-weight: 700;
}
.russell-box .quote{
  margin-top: .4rem; color: var(--text-light);
  border-left: 3px solid var(--accent);
  padding-left: .6rem;
}
.russell-box .ref{
  margin-top: .4rem; font-size: .92rem; color: color-mix(in oklab, var(--accent) 70%, white 30%);
}

/* ========= TIMELINE — BORDO LUMINOSO FUNZIONANTE PER CARDS ========= */
.timeline-content,
.timeline .card,
.timeline-card {
  position: relative !important;
  z-index: 0 !important;
  background: linear-gradient(145deg, 
    rgba(10, 10, 30, 0.9) 0%,
    rgba(20, 20, 50, 0.8) 50%,
    rgba(10, 10, 30, 0.9) 100%) !important;
  border-radius: 20px !important;
  padding: 2rem 2.5rem !important;
  margin: 1rem 0 !important;
}

/* Contenuto sopra il bordo */
.timeline-content > *,
.timeline .card > *,
.timeline-card > * {
  position: relative !important;
  z-index: 2 !important;
}

/* BORDO LUMINOSO PRINCIPALE */
.timeline-content::before,
.timeline .card::before,
.timeline-card::before {
  content: '' !important;
  position: absolute !important;
  top: -3px !important;
  left: -3px !important;
  right: -3px !important;
  bottom: -3px !important;
  border-radius: 23px !important;
  background: linear-gradient(45deg, 
    var(--accent-purple, #b967ff), 
    var(--accent-cyan, #00ccff), 
    var(--accent-gold, #ffd86a), 
    var(--accent-purple, #b967ff)) !important;
  background-size: 300% 300% !important;
  animation: borderGlow 3s ease infinite !important;
  z-index: 1 !important;
  opacity: 0.9 !important;
  pointer-events: none !important;
  
  /* Maschera per mostrare SOLO il bordo */
  -webkit-mask: 
    linear-gradient(#fff 0 0) content-box, 
    linear-gradient(#fff 0 0) !important;
  -webkit-mask-composite: xor !important;
  mask-composite: exclude !important;
  padding: 3px !important;
}

/* Animazione del bordo */
@keyframes borderGlow {
  0%, 100% { 
    background-position: 0% 50%;
    opacity: 0.8;
  }
  50% { 
    background-position: 100% 50%;
    opacity: 1;
  }
}

/* ========= FIX MASCHERE TITOLI ========= */
.timeline-content h3,
.timeline .card h3,
.timeline-card h3,
.timeline-content h2,
.timeline .card h2,
.timeline-card h2 {
  /* RIMUOVI TUTTE LE MASCHERE */
  -webkit-mask: none !important;
  mask: none !important;
  clip-path: none !important;
  -webkit-clip-path: none !important;
  
  /* RIMUOVI BACKGROUND-CLIP TEXT */
  background: none !important;
  -webkit-background-clip: border-box !important;
  background-clip: border-box !important;
  -webkit-text-fill-color: currentColor !important;
  
  /* FORZA COLORE SOLIDO */
  color: color-mix(in oklab, var(--accent) 96%, white 4%) !important;
  opacity: 1 !important;
  filter: none !important;
  mix-blend-mode: normal !important;
  
  /* LEGGIBILITÀ MASSIMA */
  text-shadow: 0 0 10px color-mix(in oklab, var(--accent) 18%, transparent) !important;
  position: relative !important;
  z-index: 3 !important;
}

/* RIMUOVI PSEUDO-ELEMENTI DAI TITOLI */
.timeline-content h3::before,
.timeline-content h3::after,
.timeline .card h3::before,
.timeline .card h3::after,
.timeline-content h2::before,
.timeline-content h2::after,
.timeline .card h2::before,
.timeline .card h2::after {
  display: none !important;
  content: none !important;
}

/* Fallback per browser senza mask support */
@supports not ((-webkit-mask-composite: xor) or (mask-composite: exclude)) {
  .timeline-content::before,
  .timeline .card::before,
  .timeline-card::before {
    display: none !important;
  }
  
  .timeline-content,
  .timeline .card,
  .timeline-card {
    border: 2px solid var(--accent-gold, #ffd86a) !important;
    box-shadow: 
      0 0 10px color-mix(in oklab, var(--accent) 30%, transparent),
      0 0 20px color-mix(in oklab, var(--accent) 20%, transparent),
      0 0 30px color-mix(in oklab, var(--accent) 10%, transparent) !important;
  }
}

/* ---------- SMALL UTILITIES for these blocks ---------- */
.box-accent{ border:1px solid color-mix(in oklab, var(--accent) 22%, var(--menu-border) 78%); border-radius: 12px; }
.bg-accent-soft{ background: color-mix(in oklab, var(--accent) 10%, transparent); }
.text-accent-strong{ color: color-mix(in oklab, var(--accent) 90%, white 10%); }

/* ====== TIMELINE: titoli e indicatori seguono l'accento ====== */
:root body .timeline h1,
:root body .timeline h2,
:root body .timeline h3,
:root body .timeline .section-title,
:root body .timeline-title,
:root body #timeline-title{
  color: color-mix(in oklab, var(--accent) 90%, white 10%) !important;
  text-shadow: 0 0 18px color-mix(in oklab, var(--accent) 22%, transparent) !important;
  background: linear-gradient(90deg, var(--accent), var(--accent-3), var(--accent)) !important;
  -webkit-background-clip: text; background-clip: text; color: transparent !important;
}
:root body .timeline .dot,
:root body .timeline .marker,
:root body .timeline .axis{
  background: var(--accent) !important;
  border-color: color-mix(in oklab, var(--accent) 55%, transparent) !important;
}

/* ====== MENU PRINCIPALE / NAV: hover & active tematizzati ====== */
:root body nav a,
:root body .main-nav a,
:root body .top-bar nav a,
:root body .menu a{
  transition: color .15s ease, border-color .15s ease, background .15s ease;
}
:root body nav a:hover,
:root body .main-nav a:hover,
:root body .top-bar nav a:hover,
:root body .menu a:hover{
  color: color-mix(in oklab, var(--accent) 85%, white 15%) !important;
  text-decoration: none;
}
:root body nav a.active,
:root body .main-nav a.active,
:root body .top-bar nav a.active,
:root body .menu a.active{
  color: var(--accent) !important;
  border-bottom: 2px solid var(--accent) !important;
}

/* ====== MEGA-MENU: titoli colonna & voci (se nomi diversi) ====== */
:root body .mega-menu .col-title,
:root body .mega .col-title,
:root body .megamenu .col-title{
  color: var(--accent) !important;
  text-shadow: 0 0 12px color-mix(in oklab, var(--accent) 25%, transparent) !important;
}
:root body .mega-menu a.item,
:root body .mega a.item,
:root body .megamenu a.item{
  border-radius: 10px;
}
:root body .mega-menu a.item:hover,
:root body .mega a.item:hover,
:root body .megamenu a.item:hover{
  background: color-mix(in oklab, var(--accent) 14%, transparent) !important;
  color: color-mix(in oklab, var(--accent) 82%, white 18%) !important;
}

/* ====== RUSSELL BOX (variazioni di classe comuni) ====== */
:root body .russell-box,
:root body .russel-box,
:root body .box-russell{
  border: 1px solid color-mix(in oklab, var(--accent) 35%, var(--menu-border) 65%) !important;
  background: radial-gradient(600px 300px at -10% -10%,
              color-mix(in oklab, var(--accent) 12%, transparent), transparent 60%) !important;
  box-shadow: 0 12px 34px color-mix(in oklab, var(--accent) 10%, transparent) !important;
}
:root body .russell-box .title,
:root body .russel-box .title,
:root body .box-russell .title{
  color: color-mix(in oklab, var(--accent) 85%, white 15%) !important;
  text-shadow: 0 0 12px color-mix(in oklab, var(--accent) 25%, transparent) !important;
}
:root body .russell-box .quote,
:root body .russel-box .quote,
:root body .box-russell .quote{
  border-left: 3px solid var(--accent) !important;
}
:root body .russell-box .ref,
:root body .russel-box .ref,
:root body .box-russell .ref{
  color: color-mix(in oklab, var(--accent) 70%, white 30%) !important;
}

/* ====== FALLBACK UTILITY: applica accento ovunque serva ====== */
/* Aggiungi data-follow-accent a qualunque blocco "testardo" */
:root body [data-follow-accent],
:root body .follow-accent{
  --_accent-local: var(--accent);
  color: color-mix(in oklab, var(--_accent-local) 90%, white 10%) !important;
}
:root body [data-follow-accent] a,
:root body .follow-accent a{
  color: color-mix(in oklab, var(--_accent-local) 82%, white 18%) !important;
}
:root body [data-follow-accent] .border,
:root body .follow-accent .border{
  border-color: var(--_accent-local) !important;
}

/* === TOP-BAR: spaziature pulite tra elementi a sinistra === */

/* 1) usa il gap nativo del flex container */
.top-bar{
  display:flex;
  align-items:center;
  gap: .8rem;              /* spazio di base fra i figli diretti */
}

/* 2) brand → switcher colori: un po' più di respiro */
.brand + .welcome-switcher{
  margin-left: .6rem;      /* aumenta se vuoi: .8rem / 1rem */
  gap: .5rem;              /* spazio interno tra i bottoni Oro/Blu/Verde/Rosso */
}

/* 3) switcher → "Maestri del Pensiero" (anch'esso è .btn-ghost) */
.welcome-switcher + .btn-ghost,
.welcome-switcher + [class*="btn"]{
  margin-left: .8rem;      /* distanzia il blocco "Maestri" dallo switcher */
}

/* 4) tieni il gruppo destro a destra, ma con un piccolo stacco dal blocco sinistro */
.bar-right{
  margin-left: auto;       /* spinge a destra */
}
.brand + .welcome-switcher + .btn-ghost + .bar-right,
.welcome-switcher + .btn-ghost + .bar-right{
  margin-left: 1rem;       /* leggero spazio prima del gruppo destro */
}

/* 5) ritocco leggibile dei ghost (facoltativo) */
.welcome-switcher .btn-ghost{
  padding: .5rem .8rem;
}

/* 6) su schermi stretti riduci gli spazi per non andare a capo */
@media (max-width: 640px){
  .top-bar{ gap: .5rem; }
  .brand + .welcome-switcher{ margin-left: .4rem; gap: .35rem; }
  .welcome-switcher + .btn-ghost{ margin-left: .5rem; }
}
/* ========= TIMELINE — FIX ALLINEAMENTO E MASCHERA CARDS ========= */

/* CONTENITORE PRINCIPALE TIMELINE */
.timeline {
  display: flex !important;
  flex-direction: column !important;
  align-items: center !important;
  width: 100% !important;
  position: relative !important;
}

/* CARD SINISTRA E DESTRA - ALLINEAMENTO CORRETTO */
.timeline .card.left,
.timeline .card.right,
.timeline-card.left, 
.timeline-card.right {
  position: relative !important;
  width: 45% !important;
  margin: 2rem 0 !important;
  z-index: 1 !important;
}

/* CARD SINISTRA - ALLINEA A SINISTRA */
.timeline .card.left,
.timeline-card.left {
  align-self: flex-start !important;
  margin-left: 0 !important;
  margin-right: auto !important;
}

/* CARD DESTRA - ALLINEA A DESTRA */
.timeline .card.right,
.timeline-card.right {
  align-self: flex-end !important;
  margin-left: auto !important;
  margin-right: 0 !important;
}

/* CONTENUTO CARD CON BORDO LUMINOSO FUNZIONANTE */
.timeline .card,
.timeline-card {
  position: relative !important;
  background: linear-gradient(145deg, 
    rgba(10, 10, 30, 0.95) 0%,
    rgba(20, 20, 50, 0.85) 50%,
    rgba(10, 10, 30, 0.95) 100%) !important;
  border-radius: 20px !important;
  padding: 2rem !important;
  border: 1px solid color-mix(in oklab, var(--accent) 25%, transparent) !important;
}

/* BORDO LUMINOSO - VERSIONE SEMPLIFICATA E FUNZIONANTE */
.timeline .card::before,
.timeline-card::before {
  content: '' !important;
  position: absolute !important;
  top: -2px !important;
  left: -2px !important;
  right: -2px !important;
  bottom: -2px !important;
  border-radius: 22px !important;
  background: linear-gradient(45deg, 
    var(--accent-purple, #b967ff), 
    var(--accent-cyan, #00ccff), 
    var(--accent-gold, #ffd86a), 
    var(--accent-purple, #b967ff)) !important;
  background-size: 300% 300% !important;
  animation: borderGlow 3s ease infinite !important;
  z-index: -1 !important;
  opacity: 0.7 !important;
  pointer-events: none !important;
}

/* ANIMAZIONE DEL BORDO */
@keyframes borderGlow {
  0%, 100% { 
    background-position: 0% 50%;
    opacity: 0.6;
  }
  50% { 
    background-position: 100% 50%;
    opacity: 0.8;
  }
}

/* CONTENUTO SOPRA IL BORDO */
.timeline .card > *,
.timeline-card > * {
  position: relative !important;
  z-index: 2 !important;
}

/* FIX MASCHERE TITOLI - RIMUOVI TUTTE LE INTERFERENZE */
.timeline .card h3,
.timeline-card h3,
.timeline .card h2,
.timeline-card h2 {
  /* RIMUOVI MASCHERE */
  -webkit-mask: none !important;
  mask: none !important;
  clip-path: none !important;
  -webkit-clip-path: none !important;
  
  /* RIMUOVI BACKGROUND-CLIP TEXT */
  background: none !important;
  -webkit-background-clip: border-box !important;
  background-clip: border-box !important;
  -webkit-text-fill-color: currentColor !important;
  
  /* COLORE LEGGIBILE */
  color: color-mix(in oklab, var(--accent) 96%, white 4%) !important;
  text-shadow: 0 0 8px color-mix(in oklab, var(--accent) 20%, transparent) !important;
  
  /* POSIZIONAMENTO CORRETTO */
  position: relative !important;
  z-index: 3 !important;
  opacity: 1 !important;
  filter: none !important;
  mix-blend-mode: normal !important;
}

/* RIMUOVI PSEUDO-ELEMENTI CHE INTERFERISCONO */
.timeline .card h3::before,
.timeline .card h3::after,
.timeline-card h3::before,
.timeline-card h3::after {
  display: none !important;
  content: none !important;
}

/* LINEA CENTRALE TIMELINE */
.timeline::before {
  content: '' !important;
  position: absolute !important;
  left: 50% !important;
  top: 0 !important;
  bottom: 0 !important;
  width: 3px !important;
  background: linear-gradient(
    to bottom,
    transparent,
    var(--accent),
    var(--accent-3),
    var(--accent),
    transparent
  ) !important;
  transform: translateX(-50%) !important;
  z-index: 0 !important;
}

/* PUNTINI SULLA LINEA */
.timeline .dot,
.timeline .marker {
  position: absolute !important;
  left: 50% !important;
  transform: translateX(-50%) !important;
  width: 12px !important;
  height: 12px !important;
  border-radius: 50% !important;
  background: var(--accent) !important;
  border: 2px solid color-mix(in oklab, var(--accent) 80%, white 20%) !important;
  z-index: 2 !important;
  box-shadow: 0 0 10px color-mix(in oklab, var(--accent) 50%, transparent) !important;
}

/* RESPONSIVE PER MOBILE */
@media (max-width: 768px) {
  .timeline .card.left,
  .timeline .card.right,
  .timeline-card.left,
  .timeline-card.right {
    width: 90% !important;
    align-self: center !important;
    margin-left: auto !important;
    margin-right: auto !important;
  }
  
  .timeline::before {
    left: 30px !important;
  }
  
  .timeline .dot,
  .timeline .marker {
    left: 30px !important;
  }
}

/* FIX PER CARDS SENZA CLASSI LEFT/RIGHT */
.timeline .card:nth-child(odd) {
  align-self: flex-start !important;
  margin-left: 0 !important;
  margin-right: auto !important;
}

.timeline .card:nth-child(even) {
  align-self: flex-end !important;
  margin-left: auto !important;
  margin-right: 0 !important;
}

/* FIX PER CONTENUTO TIMELINE ESISTENTE */
.timeline-content {
  position: relative !important;
  z-index: 2 !important;
}

/* ASSICURA CHE LE CARD SIANO VISIBILI */
.timeline .card,
.timeline-card {
  visibility: visible !important;
  opacity: 1 !important;
  transform: none !important;
}
