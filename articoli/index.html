<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <title>Articoli e Approfondimenti ‚Äî Echi di Sofia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Tutti gli articoli e gli approfondimenti pubblicati su Echi di Sofia.">
  <link rel="canonical" href="https://www.echidisofia.org/articoli/">
  <link rel="icon" type="image/png" href="/favicon_io/favicon-32x32.png">

<!-- Preload dell'indice di ricerca -->
<link rel="preload" href="/search-index.json?v=20251106" as="fetch" type="application/json">

<link rel="preload" href="/search-index.json?v=20251106" as="fetch" type="application/json" crossorigin>
  <style>
    :root{ --bg:#0a0a1a; --text:#e9eef5; --gold:#ffd86a; --cyan:#9ad0ff; --panel:rgba(10,10,30,.94); --border:rgba(255,215,0,.22); --muted:#9bb7ff; }
    *{ box-sizing:border-box; } html{ scroll-behavior:smooth; }
    body{ margin:0; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif; min-height:100dvh; display:flex; flex-direction:column; }
    a{ color:var(--cyan); text-decoration:none; } a:hover{ color:#fff; text-decoration:underline; }
    .wrap{ width:min(1200px,94vw); margin:0 auto; }

    /* Topbar */
    header.topbar{ position:sticky; top:0; z-index:50; background:rgba(18,28,58,.96); border-bottom:1px solid var(--border); backdrop-filter: blur(8px); }
    .row{ display:flex; align-items:center; gap:.75rem; padding:.8rem 1rem; }
    .brand{ display:flex; align-items:center; gap:.6rem; color:var(--gold); font-weight:800; text-decoration:none; }
    .brand .logo{ width:28px; height:28px; color: currentColor; filter: drop-shadow(0 0 .35rem rgba(255,215,0,.35)); }
    .brand span{ background:linear-gradient(90deg,#ffd700,#fff7b0,#ffd700); -webkit-background-clip:text; background-clip:text; color:transparent; letter-spacing:.04em; }
    .spacer{ flex:1; }
    .nav{ display:flex; gap:.5rem; flex-wrap:wrap; }
    .nav a{ font-weight:700; color:var(--cyan); border:1px solid rgba(0,204,255,.35); padding:.45rem .7rem; border-radius:.6rem; }
    .nav a:hover{ color:#fff; }
    .nav a.active,[aria-current="page"]{ background: rgba(0,204,255,.12); color:#fff; border-color: rgba(0,204,255,.6); text-decoration:none; }

    /* Hero */
    .hero{ padding:1.6rem 1rem .8rem; border-bottom:1px solid rgba(255,255,255,.06); text-align:center; }
    .hero h1{ margin:.2rem 0 .2rem; font-size:clamp(1.6rem,3.4vw,2.4rem); color:#ffeb9a; }
    .hero p{ margin:0 auto; max-width:68ch; color:#cfe8ff; opacity:.95; }

    /* CTA */
    .cta{ padding:1rem 1rem 0; display:flex; gap:.6rem; flex-wrap:wrap; justify-content:center; }
    .btn{ display:inline-flex; align-items:center; gap:.4rem; padding:.55rem .85rem; border-radius:.6rem; background:rgba(20,20,40,.78); font-weight:700; }
    .btn.primary{ color:#ffdf8a; border:1px solid var(--border); }
    .btn.secondary{ color:#9ad0ff; border:1px solid rgba(0,204,255,.35); }

    main{ padding:1rem; }

    /* Barra filtri */
    .filterbar{
      display:flex; align-items:center; gap:.6rem; flex-wrap:wrap;
      padding:.75rem 1rem; margin:.4rem 0 1rem;
      background:rgba(10,10,30,.9); border:1px solid rgba(255,255,255,.08); border-radius:12px;
    }
    .filterbar label{ font-weight:700; color:#ffeb9a; margin-right:.25rem; }
    .filterbar .meta{ color:var(--muted); opacity:.92; margin-left:auto; font-size:.95rem; }
    .filter-select{
      background:rgba(20,20,40,.85); color:#e9eef5; border:1px solid rgba(255,255,255,.14);
      border-radius:10px; padding:.45rem .6rem; font-size:.95rem; outline:none;
    }
    .chips{ display:flex; gap:.4rem; flex-wrap:wrap; }
    .chip{
      border:1px solid rgba(0,204,255,.28); color:#9ad0ff; background:rgba(20,20,40,.78);
      padding:.38rem .6rem; border-radius:999px; font-weight:700; font-size:.9rem; cursor:pointer;
    }
    .chip.active{ border-color: rgba(0,204,255,.65); color:#fff; background:rgba(0,204,255,.12); }

    /* Griglia articoli */
    #lista-articoli { scroll-margin: 120px; }
    @media (max-width: 768px){ #lista-articoli{ scroll-margin-top: 140px; } }
    .grid{ display:grid; gap:1rem; grid-template-columns: repeat(auto-fit, minmax(240px,1fr)); }
    .card{ background:var(--panel); border:1px solid var(--border); border-radius:14px; padding:1rem; display:flex; flex-direction:column; gap:.55rem; box-shadow:0 1.2rem 2.2rem rgba(0,0,0,.25); }
    .card h3{ color:#ffeb9a; margin:.2rem 0 0; } .card p{ color:#cfe2ff; opacity:.95; line-height:1.35; }
    .badge{ display:inline-block; font-size:.78rem; padding:.12rem .5rem; border-radius:999px; color:#0b1022; background:linear-gradient(90deg,#ffd86a,#ffeb9a); font-weight:800; }
    .more{ margin-top:auto; } .more a{ font-weight:800; }

    footer{ margin-top:auto; padding:1rem; text-align:center; color:#9ec3ff; border-top:1px solid rgba(255,255,255,.06); }

    /* Overlay di ricerca */
    .search-overlay{ position: fixed; inset: 0; z-index: 9999; background: rgba(0,0,0,.55); backdrop-filter: blur(6px); display: none; }
    .search-overlay.is-open{ display:block; }
    .search-panel{
      position: absolute; left: 50%; top: 8%; transform: translateX(-50%);
      width: min(900px, 92vw); background: rgba(10,10,30,.96);
      border: 1px solid rgba(255,215,0,.22); border-radius: 14px; box-shadow: 0 1.4rem 2.4rem rgba(0,0,0,.45); color: #e9eef5;
    }
    .search-header{ display:flex; align-items:center; gap:.6rem; padding:.9rem 1rem; border-bottom:1px solid rgba(255,255,255,.08); }
    .search-header input{ flex:1; background: rgba(20,20,40,.85); color:#e9eef5; border:1px solid rgba(255,255,255,.14); border-radius: 10px; padding:.7rem .9rem; font-size:1rem; outline:none; }
    .search-close{ appearance:none; border:1px solid rgba(255,255,0,.18); background: rgba(20,20,40,.85); color:#ffdf8a; font-weight:800; border-radius:10px; padding:.55rem .75rem; cursor:pointer; }
    .search-hint{ padding:.4rem 1rem .7rem; opacity:.85; font-size:.92rem; }
    .search-results{ padding: .8rem 1rem 1rem; display:grid; gap:.75rem; max-height: 60vh; overflow:auto; }
    .search-card{ background: rgba(15,15,35,.92); border:1px solid rgba(255,215,0,.16); border-radius: 12px; padding: .9rem; }
    .search-card .title{ color:#cfefff; font-weight:800; text-decoration:none; font-size:1.05rem; }
    .search-card .title:hover{ color:#fff; text-decoration:underline; }
    .search-card .url{ font-size:.85rem; color:#9bb7ff; opacity:.9; margin:.25rem 0 .35rem; word-break: break-all; }
    .search-card .desc{ color:#cfe2ff; opacity:.95; line-height:1.35; }

    /* Evidenziazione */
    mark{ background: rgba(173,216,230,.5); color:#1a3a4a; padding:.1em .2em; border-radius:.25em; box-shadow: inset 0 0 0 1px rgba(135,206,235,.7); font-weight:700; }

    /* Accessibilit√† */
    a:focus-visible,button:focus-visible,input:focus-visible{ outline:2px solid var(--cyan); outline-offset:2px; border-radius:2px; }
  </style>
  <!-- Preload dell'indice di ricerca -->
<link rel="preload"
      href="/search-index.json?v=20251106"
      as="fetch"
      type="application/json">

<!-- Configurazione UNICA della ricerca -->
<script id="search-config-root">
  (function () {
    const ts = Date.now(); // forza sempre una versione ‚Äúfresca‚Äù del JSON

    window.SEARCH_INDEX_URLS = [
      '/search-index.json?v=' + ts,  // prima prova: no cache
      '/search-index.json'           // fallback
    ];

    window.SEARCH_CONFIG = {
      indexUrls: window.SEARCH_INDEX_URLS,
      debounceTime: 300,
      minQueryLength: 2,
      version: '20251106'
    };

    console.log('üîç SEARCH_INDEX_URLS impostate:', window.SEARCH_INDEX_URLS);
  })();
</script>

</head>
<body>

  <!-- TOP BAR -->
  <header class="topbar">
    <div class="wrap row">
      <a class="brand" href="/" aria-label="Echi di Sofia ‚Äì Home">
        <svg class="logo" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
          <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
          <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
          <line x1="12" y1="22.08" x2="12" y2="12"></line>
        </svg>
        <span>Echi di Sofia</span>
      </a>
      <div class="spacer"></div>
      <nav class="nav">
        <a class="active" aria-current="page" href="/articoli/">Articoli</a>
        <a href="/cerca.html">üîé Cerca</a>
        <a href="/">üè† Incipit</a>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero wrap">
    <h1>Articoli e Approfondimenti</h1>
    <p>La raccolta completa dei contenuti pubblicati su Echi di Sofia.</p>
    <div class="cta">
      <a class="btn primary" href="/cerca.html" aria-label="Apri la pagina di ricerca">üîé Cerca</a>
      <a class="btn secondary" href="/" aria-label="Torna alla home (Incipit)">üè† Torna all‚ÄôIncipit</a>
    </div>
  </section>

  <!-- FILTRI -->
  <section class="wrap">
    <div class="filterbar" role="region" aria-label="Filtra per categoria">
      <label for="filter-select">Categoria:</label>
      <select id="filter-select" class="filter-select" aria-label="Seleziona categoria">
        <option value="">Tutte</option>
      </select>
      <div class="chips" id="filter-chips" aria-label="Categorie"></div>
      <div class="meta" id="filter-meta">0 risultati</div>
    </div>
  </section>

  <!-- GRIGLIA -->
  <main class="wrap">
    <h2 style="margin:.8rem 0 1rem; color:#ffeb9a;">Tutti gli articoli</h2>
    <div class="grid" id="lista-articoli">
      <p style="opacity:.8">Caricamento articoli‚Ä¶</p>
    </div>
  </main>

  <footer>¬© 2025 Echi di Sofia</footer>

  <!-- OVERLAY DI RICERCA -->
  <div class="search-overlay" id="search-overlay" aria-hidden="true">
    <div class="search-panel" role="dialog" aria-modal="true" aria-labelledby="search-title">
      <div class="search-header">
        <strong id="search-title">Cerca</strong>
        <input id="site-search" type="search" placeholder="Cerca‚Ä¶ (es. Platone, Ipazia, Talete)" autocomplete="off" spellcheck="false">
        <button class="search-close" id="close-search" type="button" aria-label="Chiudi">‚úï</button>
      </div>
      <div class="search-hint">Suggerimento: puoi cercare per <em>titolo</em> o parole nella <em>descrizione</em>. Premi <kbd>Esc</kbd> per chiudere.</div>
      <div id="search-results" class="search-results" role="list" aria-live="polite"></div>
    </div>
  </div>

  <!-- SCRIPT: griglia + filtri + overlay -->
  <script>
  (function(){
    const SOURCES = (window.SEARCH_INDEX_URLS && window.SEARCH_INDEX_URLS.length)
      ? window.SEARCH_INDEX_URLS
      : ['/search-index.json','/assets/search-index.json'];

    const GRID   = document.getElementById('lista-articoli');
    const META   = document.getElementById('filter-meta');
    const SELECT = document.getElementById('filter-select');
    const CHIPS  = document.getElementById('filter-chips');

    let DATA = [];        // articoli normalizzati
    let TAGS = [];        // [categoria, count]
    let CURRENT = '';     // filtro attivo

    // üîí Escludi per sempre le 6 ‚ÄúSezioni del portale‚Äù
    const EXCLUDE_URLS = new Set([
      '/articoli/cinismo.html',
      '/articoli/epicureismo.html',
      '/articoli/filosofia-indiana.html',
      '/articoli/platonismo.html',
      '/articoli/scetticismo.html',
      '/articoli/stoicismo.html'
    ]);
    const EXCLUDE_DIRS = /^(\/)?(Sezioni|pagine)(\/|$)/i;

    function href(u){ if(!u) return '#'; if(/^https?:\/\//i.test(u)) return u; if(u.startsWith('/')) return u; return '/' + u.replace(/^\.\//,''); }
    function getCat(it){ return (it.category || it.categoria || it.section || it.tag || it.type || '').toString().trim(); }
    function shouldKeep(it){
      const u = (it.url||'').toString();
      const d = (it.description || it.desc || '').toString();
      const c = getCat(it).toLowerCase();
      if (!/\.html?(\?|#|$)/i.test(u)) return false;
      if (EXCLUDE_URLS.has(u)) return false;
      if (EXCLUDE_DIRS.test(u)) return false;
      if (/sezione del portale/i.test(d)) return false;
      if (c === 'sezione') return false;
      return true;
    }

    function card(it){
      const link = href(it.url);
      const title = it.title || 'Senza titolo';
      const desc  = it.description || it.desc || '';
      const cat   = getCat(it);
      return `<article class="card">
                ${cat ? `<span class="badge">${cat}</span>` : ``}
                <h3>${title}</h3>
                ${desc ? `<p>${desc}</p>` : ``}
                <div class="more"><a href="${link}">Leggi ‚Üí</a></div>
              </article>`;
    }

    function render(list){
      if(!GRID) return;
      GRID.innerHTML = list.length ? list.map(card).join('') : '<p style="opacity:.8">Nessun articolo trovato.</p>';
      META.textContent = `${list.length} risultato${list.length===1?'':'i'}`;
    }

    function uniqueTags(items){
      const map = new Map();
      for(const it of items){
        const t = getCat(it);
        if(!t) continue;
        map.set(t, (map.get(t)||0)+1);
      }
      return Array.from(map.entries()).sort((a,b)=> a[0].localeCompare(b[0]));
    }

    function buildFilters(){
      // select
      SELECT.innerHTML = `<option value="">Tutte</option>` +
        TAGS.map(([t,c])=> `<option value="${encodeURIComponent(t)}"${t===CURRENT?' selected':''}>${t} (${c})</option>`).join('');
      // chips
      CHIPS.innerHTML = [`<button class="chip${!CURRENT?' active':''}" data-cat="">Tutte (${DATA.length})</button>`]
        .concat(TAGS.map(([t,c])=> `<button class="chip${CURRENT===t?' active':''}" data-cat="${encodeURIComponent(t)}">${t} (${c})</button>`))
        .join('');
      CHIPS.querySelectorAll('.chip').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const val = decodeURIComponent(btn.getAttribute('data-cat')||'');
          setFilter(val, {push:true});
        });
      });
    }

    function filtered(){
      if(!CURRENT) return DATA;
      const key = CURRENT.toLowerCase();
      return DATA.filter(it => getCat(it).toLowerCase() === key);
    }

    function setFilter(val, {push=false}={}){
      CURRENT = val || '';
      // UI
      const enc = encodeURIComponent(CURRENT);
      Array.from(SELECT.options).forEach(o => { o.selected = (o.value === enc) || (!enc && !o.value); });
      CHIPS.querySelectorAll('.chip').forEach(btn=> btn.classList.toggle('active', btn.getAttribute('data-cat')===enc));
      // URL
      const url = new URL(window.location.href);
      if(CURRENT) url.searchParams.set('cat', CURRENT); else url.searchParams.delete('cat');
      if(push) history.pushState({cat:CURRENT}, '', url.toString());
      // Render
      render( filtered() );
      document.getElementById('lista-articoli')?.scrollIntoView({behavior:'smooth'});
    }

    if(SELECT){
      SELECT.addEventListener('change', (e)=>{
        const val = decodeURIComponent(e.target.value||'');
        setFilter(val, {push:true});
      });
    }

    // Carica indice
    (async () => {
      let arr = [];
      for(const u of SOURCES){
        try{
          const r = await fetch(u, { cache: 'no-store' });
          if(!r.ok) continue;
          const jtxt = await r.text();
          // parser tollerante
          let j;
          try { j = JSON.parse(jtxt); } catch(_){
            const s = jtxt.indexOf('['), e = jtxt.lastIndexOf(']');
            if (s !== -1 && e !== -1 && e > s) j = JSON.parse(jtxt.slice(s,e+1));
            else {
              const m = jtxt.match(/"items"\s*:\s*(\[\s*\{[\s\S]*?\}\s*\])/);
              if (m) j = {items: JSON.parse(m[1])};
            }
          }
          arr = Array.isArray(j) ? j : (j && Array.isArray(j.items) ? j.items : []);
          if (arr.length) break;
        }catch(_){}
      }

      DATA = arr.map(it => ({
        title: it.title || it.name || it.slug || 'Senza titolo',
        url: (it.url || it.link || '').toString(),
        description: it.description || it.desc || it.excerpt || it.summary || '',
        category: it.category || it.categoria || it.section || it.tag || it.type || ''
      })).filter(shouldKeep);

      TAGS = uniqueTags(DATA);
      buildFilters();

      const fromURL = new URL(window.location.href).searchParams.get('cat');
      if(fromURL){ CURRENT = fromURL; }

      render( filtered() );
    })();

    /* Overlay ricerca (usa DATA gi√† caricato) */
    const $open  = document.querySelector('a[href="/cerca.html"]'); // usa il pulsante Cerca come trigger opzionale
    const $ovl   = document.getElementById('search-overlay');
    const $close = document.getElementById('close-search');
    const $input = document.getElementById('site-search');
    const $list  = document.getElementById('search-results');

    function lockScroll(on){ document.documentElement.style.overflow=on?'hidden':''; }
    function openPanel(e){ if(e) e.preventDefault(); if(!$ovl) return; $ovl.classList.add('is-open'); $ovl.setAttribute('aria-hidden','false'); lockScroll(true); setTimeout(()=> $input?.focus(), 50); }
    function closePanel(e){ if(e) e.preventDefault(); if(!$ovl) return; $ovl.classList.remove('is-open'); $ovl.setAttribute('aria-hidden','true'); lockScroll(false); if($input){ $input.value=''; $list.innerHTML=''; } }

    if($open)  $open.addEventListener('click', openPanel);
    if($close) $close.addEventListener('click', closePanel);
    document.addEventListener('keydown',(e)=>{ if(e.key==='Escape') closePanel(); });
    if($ovl) $ovl.addEventListener('click',(e)=>{ if(e.target===$ovl) closePanel(e); });

    const norm = s => (s||'').toString().normalize('NFD').replace(/[\u0300-\u036f]/g,'').toLowerCase();
    const hl = (text, q) => {
      if(!text) return '';
      const tokens = norm(q).split(/\s+/).filter(Boolean);
      if(!tokens.length) return text;
      let out = text;
      for(const t of tokens){
        if(t.length<2) continue;
        const re = new RegExp('('+t.replace(/[.*+?^${}()|[\\]\\\\]/g,'\\$&')+')','gi');
        out = out.replace(re,'<mark>$1</mark>');
      }
      return out;
    };
    const resolve = u => /^https?:\/\//i.test(u) ? u : (u.startsWith('/') ? u : '/'+u.replace(/^\.\//,''));
    const doSearch = (q) => {
      const qq = norm(q); if(!qq) return [];
      return DATA.filter(it=>{
        const t=norm(it.title||''), d=norm(it.description||''), u=norm(it.url||'');
        return t.includes(qq)||d.includes(qq)||u.includes(qq);
      }).slice(0,60);
    };
    const renderSearch = (rows, q) => {
      if(!$list) return;
      if(!rows.length){ $list.innerHTML = `<p style="opacity:.8">Nessun risultato per <strong>${q}</strong>.</p>`; return; }
      $list.innerHTML = rows.map(it => `
        <article class="search-card" role="listitem">
          <a class="title" href="${resolve(it.url)}">${hl(it.title, q)}</a>
          <div class="url">${resolve(it.url)}</div>
          ${it.description ? `<div class="desc">${hl(it.description, q)}</div>` : ''}
        </article>
      `).join('');
    };

    if($input){
      let t;
      $input.addEventListener('input', ()=>{
        clearTimeout(t);
        const q = $input.value.trim();
        t = setTimeout(()=> renderSearch(doSearch(q), q), 120);
      });
      $input.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); renderSearch(doSearch($input.value.trim()), $input.value.trim()); } });
    }

    // Gestione back/forward del browser per ?cat=
    window.addEventListener('popstate', ()=>{
      const newCat = new URL(window.location.href).searchParams.get('cat') || '';
      if(newCat !== CURRENT){
        CURRENT = newCat;
        const enc = encodeURIComponent(CURRENT);
        Array.from(SELECT.options).forEach(o => { o.selected = (o.value === enc) || (!enc && !o.value); });
        CHIPS.querySelectorAll('.chip').forEach(btn=> btn.classList.toggle('active', btn.getAttribute('data-cat')===enc));
        render( filtered() );
      }
    });
  })();
  </script>
</body>
</html>
